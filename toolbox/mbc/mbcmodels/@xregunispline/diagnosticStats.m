function [data,factors,specialPlots,olIndex]= diagnosticStats(m,X,Y)
% xreglinear/diagnosticStats
% 
% [data,factors, specialPlots]= diagnosticStats(m)
%
% This is an overloaded function to return
% stats and factors for the diagnostic plots

%  Copyright 2000-2004 The MathWorks, Inc. and Ford Global Technologies, Inc.


%   $Revision: 1.5.4.3 $  $Date: 2004/02/09 07:58:22 $

% This gets the standard statistics
dstats= stats(m.mv3xspline,'diagnostics');
[cookd,...
      leverage,...
      residuals,...
      response,...
      Xv,...
      studres,...
      yhat,...
      ci_hi,...
      ci_lo]= deal(dstats{:});
% Plot indexes.
obs=[1:length(response)]';
% Get the global variables.
p= get(MBrowser,'CurrentNode');
if nargin<3
   [X,Y]= getdata(p.info);
end	
[Xm,Ym,DataOk]= checkdata(m,X,Y);
Xm= invcode(m,Xm);

data= [yhat,...
      studres,...
      residuals,...
      leverage,...
      obs,...  
      response,...
      Xm];
% This returns the names of the statistics
% sname= get(X,'name');
% snameY= p.name;
sname = InputLabels(m);
snameY= ResponseLabel(m);
% make it a row
[r,c]= size(sname);
if r>c
   sname= sname';
end

if isTransOneSide(m) |  isTBS(m)
    snameY= [snameY ' (transformed)',];
    factors={['Predicted ',snameY],...
          'Studentized Residuals',...
          'Residuals (transformed)',...
          'Leverage',...
          'Obs. number',...
          snameY};
else
    factors={['Predicted ',snameY],...
          'Studentized Residuals',...
          'Residuals',...
          'Leverage',...
          'Obs. number',...
          snameY};
 end

factors= [factors,sname];

% This is a list of special plots. This can be empty
specialPlots= {'Predicted/Observed',...
      'Normal plot'};

% outlier index
olIndex= outliers(m,data,factors);
