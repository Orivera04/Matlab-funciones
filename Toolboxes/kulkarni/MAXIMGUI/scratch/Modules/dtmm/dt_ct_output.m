function [dtmmfig] = dt_ct_output(title_bar,rownum, title, total_dim)

% Display results for DTMM or CTMM

% global variables (handles only)
global TransColLabelHandle TransRowLabelHandle TransMatrixHandle TransDistHandle ...
       MeanFPTHandle VarFPTHandle OccColLabelHandle OccRowLabelHandle OccMatrixHandle ...
       OccDistHandle MeanCostHandle  LongRunCostHandle

% local vars
maxdim = 6 ;  % maximum dimension without having to scroll
dim = min(maxdim, total_dim) ;  % max dimension can display at one time
std_state = get_std_model_state(rownum);
% Main figure
dtmmfig = figure('Name', title_bar, ...
                 'Units','normalized', ...
	              'Color',[0.8 0.8 0.8], ...
	              'MenuBar','none', ...
	              'NumberTitle','off', ...
	              'Position',[0.4 0.05 0.55 0.90], ...
	              'Tag','DT_CT_Output');

% Menu options for this figure
exit = uimenu(dtmmfig, ...
              'Label', 'Close Figure',...
              'Tag','CloseFig', ...
              'Callback','close') ;
save = uimenu(dtmmfig, ...
              'Label', 'Save Results', ...
              'Callback', sprintf('printto(''dt_ct'', ''file'') ;'), ...
              'Tag', 'SaveFig') ;
if std_state == 0           
save_model = uimenu(dtmmfig, ...
              'Label', 'Save Model', ...
              'Callback', sprintf('save_new_model(%d);',rownum), ...
              'Tag', 'PrintFig') ;
end
% Title
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.5, ...
	       'Position',[0.1 0.95 0.8 0.04], ...
	       'Style','text', ...
          'String', title, ...
	       'Tag','Title') ;

% Area Text Labels
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.4, ...
	       'Position',[0.2 0.9 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Transition Matrix', ...
	       'Tag','TransitionMatrix');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
          'BackgroundColor',[0.8 0.8 0.8], ...
          'HorizontalAlignment', 'center', ...
	       'FontSize',0.2, ...
	       'Position',[0.725 0.9 0.25 0.04], ...
	       'Style','text', ...
          'String', 'First Passage Time', ...
          'Tag','FPT');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.4, ...
	       'Position',[0.75 0.87 0.1 0.025], ...
	       'Style','text', ...
          'String', 'Mean', ...
	       'Tag','MeanCost');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.4, ...
	       'Position',[0.86 0.87 0.125 0.025], ...
	       'Style','text', ...
          'String', 'Variance', ...
	       'Tag','VarianceCost');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.2, ...
	       'Position',[0.2 0.55 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Transient Distribution', ...
	       'Tag','TransientDist');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.2, ...
	       'Position',[0.2 0.45 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Occupancy Matrix', ...
	       'Tag','OccMatrix');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.2, ...
	       'Position',[0.2 0.1 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Occupancy/Limiting Dist.', ...
	       'Tag','OccDist');
uicontrol('Parent',dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.2, ...
	       'Position',[0.725 0.50 0.25 0.07], ...
	       'Style','text', ...
          'String', 'Expected Total Cost', ...
	       'Tag','TotalCost');
uicontrol('Parent', dtmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.2, ...
          'Position', [0.725 0.1 0.25 0.04], ...
	       'Style','text', ...
          'String', 'Long-run Cost Rate', ...
          'Tag', 'LongRunCost') ;

% Sliders
if (total_dim > maxdim)

   if total_dim - maxdim == 1
     eachstep = .99 ;
   else 
     eachstep = 1 / (total_dim - maxdim) ;
   end

   uicontrol('Parent',dtmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.7 0.62 0.03 0.24], ...
             'Style','slider', ...
             'Value', 1, ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_vtrans(%d)', maxdim), ...
             'Tag','TransVSlider');
   uicontrol('Parent',dtmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.06 0.59 0.6 0.024], ...
             'Style','slider', ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_htrans(%d)', maxdim), ...
             'Tag','TransHSlider');
   uicontrol('Parent',dtmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.06 0.15 0.6 0.024], ...
             'Style','slider', ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_hocc(%d)', maxdim), ...
             'Tag','OccHSlider');
   uicontrol('Parent',dtmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.7 0.18 0.03 0.24], ...
             'Style','slider', ...
             'Value', 1, ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_vocc(%d)', maxdim), ...
             'Tag','OccVSlider');
end

% Transition Matrix Column Labels
for c = 1:dim
  TransColLabelHandle(c) = uicontrol('Parent',dtmmfig, ...
	                                  'Units','normalized', ...
	                                  'FontUnits','normalized', ...
	                                  'BackgroundColor',[0.8 0.8 0.8], ...
	                                  'FontSize',0.367816, ...
	                                  'Position',[(.1*c)-0.04 0.86 0.1 0.025], ...
	                                  'Style','text', ...
	                                  'Tag','TransColLabel', ...
                                     'UserData', [c]);
end

% Transition Matrix Row Labels
for r = 1:dim
  TransRowLabelHandle(r) = uicontrol('Parent',dtmmfig, ...
	                                  'Units','normalized', ...
	                                  'FontUnits','normalized', ...
	                                  'BackgroundColor',[0.8 0.8 0.8], ...
	                                  'FontSize',0.355556, ...
	                                  'Position',[0.01 0.86-(0.04*r) 0.05 0.04], ...
	                                  'Style','text', ...
	                                  'Tag','TransRowLabel', ...
                                     'UserData', [r]);
end

% Transition Matrix Value
for r = 1:dim
  for c = 1:dim
    TransMatrixHandle(r,c) = uicontrol('Parent',dtmmfig, ...
	                                    'Units','normalized', ...
	                                    'FontUnits','normalized', ...
             	                        'BackgroundColor',[1 1 1], ...
	                                    'FontSize',0.367816, ...
	                                    'Position',[(.1*c)-0.04 0.86-(0.04*r) 0.1 0.04], ...
	                                    'Style','edit', ...
	                                    'Tag','TransMatrixValue', ...
                                       'UserData', [r,c]);
  end
end

% Mean First Passage Time Vector
for r = 1:dim
  MeanFPTHandle(r) = uicontrol('Parent',dtmmfig, ...
	                        'Units','normalized', ...
    	                     'FontUnits','normalized', ...
	                        'BackgroundColor',[1 1 1], ...
	                        'FontSize',0.355556, ...
	                        'Position',[0.75 0.86-(0.04*r) 0.1 0.04], ...
	                        'Style','edit', ...
	                        'Tag','MeanFPTValue', ...
                           'UserData', [r]);
end
%  Variance of First Passge time Vector
for r = 1:dim
  VarFPTHandle(r) = uicontrol('Parent',dtmmfig, ...
	                            'Units','normalized', ...
	                            'FontUnits','normalized', ...
	                            'BackgroundColor',[1 1 1], ...
	                            'FontSize',0.355556, ...
	                            'Position',[0.86 0.86-(0.04*r) 0.1 0.04], ...
	                            'Style','edit', ...
	                            'Tag','VarFPTValue', ...
                               'UserData', [r]);
end

% Transient Distribution Value
for c = 1:dim
  TransDistHandle(c) = uicontrol('Parent',dtmmfig, ...
	                              'Units','normalized', ...
	                              'FontUnits','normalized', ...
	                              'BackgroundColor',[1 1 1], ...
	                              'FontSize',0.367816, ...
	                              'Position',[(.1*c)-0.04 0.50 0.1 0.04], ...
	                              'Style','edit', ...
	                              'Tag','TransDistValue', ...
                                 'UserData', [c]);
end

% Occupancy Matrix Column Labels
for c = 1:dim
  OccColLabelHandle(c) = uicontrol('Parent',dtmmfig, ...
	                                'Units','normalized', ...
	                                'FontUnits','normalized', ...
	                                'BackgroundColor',[0.8 0.8 0.8], ...
	                                'FontSize',0.367816, ...
	                                'Position',[(.1*c)-0.04 0.42 0.1 0.025], ...
	                                'Style','text', ...
	                                'Tag','OccColLabel', ...
                                   'UserData', [c]);
end

% Occupancy Matrix Row Labels
for r = 1:dim
  OccRowLabelHandle(r) = uicontrol('Parent',dtmmfig, ...
	                                'Units','normalized', ...
	                                'FontUnits','normalized', ...
	                                'BackgroundColor',[0.8 0.8 0.8], ...
	                                'FontSize',0.355556, ...
	                                'Position',[0.01 0.42-(0.04*r) 0.05 0.04], ...
	                                'Style','text', ...
	                                'Tag','OccRowLabel', ...
                                   'UserData', [r]);
end

% Occupancy Matrix Values
for r = 1:dim
  for c = 1:dim
    OccMatrixHandle(r,c) = uicontrol('Parent',dtmmfig, ...
	                                  'Units','normalized', ...
	                                  'FontUnits','normalized', ...
	                                  'BackgroundColor',[1 1 1], ...
	                                  'FontSize',0.367816, ...
	                                  'Position',[(.1*c)-0.04 0.42-(0.04*r) 0.1 0.04], ...
	                                  'Style','edit', ...
	                                  'Tag','OccMatrixValue', ...
                                     'UserData', [r,c]);
  end
end

% Limiting/Occupancy Distribution Values
for c = 1:dim
  OccDistHandle(c) = uicontrol('Parent',dtmmfig, ...
	                            'Units','normalized', ...
	                            'FontUnits','normalized', ...
	                            'BackgroundColor',[1 1 1], ...
	                            'FontSize',0.367816, ...
	                            'Position',[(.1*c)-0.04 0.05 0.1 0.04], ...
	                            'Style','edit', ...
	                            'Tag','OccDistValue', ...
                               'UserData', [c]);
end

% Expected Total Cost Value
for r = 1:dim
  MeanCostHandle(r) = uicontrol('Parent',dtmmfig, ...
	                             'Units','normalized', ...
	                             'FontUnits','normalized', ...
	                             'BackgroundColor',[1 1 1], ...
	                             'FontSize',0.355556, ...
	                             'Position',[0.8 0.42-(0.04*r) 0.1 0.04], ...
	                             'Style','edit', ...
	                             'Tag','MeanCostValue', ...
                                'UserData', [r]);
end


% Long-run Cost Rate Value
LongRunCostHandle = uicontrol('Parent', dtmmfig, ...
                              'Units','normalized', ...
	                           'FontUnits','normalized', ...
	                           'BackgroundColor',[1 1 1], ...
	                           'FontSize',0.355556, ...
	                           'Position',[0.8 .05 0.1 0.04], ...
	                           'Style','edit', ...
                              'Tag', 'LongRunCostValue') ;
