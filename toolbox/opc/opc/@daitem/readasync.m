function transID = readasync(obj)
%READASYNC Read data asynchronously from group or items.
%   TransID = READASYNC(GObj) and 
%   TransID = READASYNC(IObj) asynchronously reads data for all the items
%   contained in the dagroup object, GObj, or for the vector of daitem
%   objects specified by IObj. TransID is a unique transaction ID for the
%   asynchronous request.
%
%   For asynchronous reads, data is always read from the device, and not
%   from the server cache. The Active property is ignored for asynchronous
%   reads.
%
%   When the read operation completes, a ReadAsync event is generated by
%   the server. If an M-file callback function is specified for the
%   ReadAsyncFcn property, then that function executes when the event is
%   generated.
%
%   You can cancel an in-progress asynchronous request using CANCELASYNC.
%
%   Examples
%       da = opcda('localhost', 'Matrikon.OPC.Simulation');
%       connect(da);
%       grp = addgroup(da, 'ExReadAsync');
%       set(grp, 'UpdateRate', 20);
%       itm = additem(grp, 'Random.Real8');
%       tid1 = readasync(grp)
%       tid2 = readasync(grp, 'device')
%       pause(2)
%       disp('Event log:')
%       showopcevents(da)
%
%   See also DAGROUP/CANCELASYNC, DAGROUP/READ, DAGROUP/REFRESH, 
%            DAGROUP/WRITE, DAGROUP/WRITEASYNC.

% Copyright 2003-2004 OPTI-NUM solutions (Pty) Ltd.
% $Revision: 1.1.6.7 $  $Date: 2004/02/01 22:06:45 $

% Validity check
I = isvalid(obj);
if all(~I)
    rethrow(mkerrstruct('opc:readasync:objinvalid'));
elseif any(~I)
    warning('opc:readasync:objinvalid','READASYNC has not been applied to the invalid daitem objects.')
end

% Find valid objects
uddHandle = getudd(obj);
uddValid = uddHandle(I);

% Item must be part of a connected object
if ~strcmpi(get(get(uddValid(1).Parent,'Parent'),'Status'),'connected')
   rethrow(mkerrstruct('opc:readasync:parentdisconnected'));
end

% perform the read
try
    transID = udreadasync(uddValid);
catch
    rethrow(mkerrstruct(lasterror));
end
