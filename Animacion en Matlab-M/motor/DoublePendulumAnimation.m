function DoublePendulumAnimation
close all;
% parameters and colors and all
button_color='c';
panel_color=[.7 .7 .8];
panel_color2=[1 .5 .3];
pushbutton_color='r';

hFigure=figure;
set(hFigure,...
    'Units','pixels',...
    'Position',[0 0 1100 700],...
    'color',[.45 .5 .45]);
hAxes=axes;
set(hAxes,...
    'Parent',hFigure,...
    'Units','pixels',...
    'Position',[40 150 400 400],...
    'XLim',[-10,10],...
    'XTick',-10:1:10,...
    'YLim',[-10,10],...
    'YTick',-10:1:10,...
    'XGrid','on',...
    'YGrid','on');

hPanel=uipanel(...
    'Parent',hFigure,...
    'Units','Pixels',...
    'Position',[500,150,250,400],...
    'BackgroundColor',panel_color);


hM1=uicontrol;
set(hM1,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[130 330 110 50],...
    'BackgroundColor',button_color,...
    'String','1',...
    'Fontsize',[14]);
hM1text=uicontrol;
set(hM1text,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[30 335 90 30],...
    'String','mass 1= ',...
    'Fontsize',[16]);

hM2=uicontrol;
set(hM2,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[130 260 110 50],...
    'BackgroundColor',button_color,...
    'String','1',...
    'Fontsize',[14]);
hM2text=uicontrol;
set(hM2text,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[30 265 90 30],...
    'String','mass 2= ',...
    'Fontsize',[16]);

hL1=uicontrol;
set(hL1,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[130 190 110 50],...
    'BackgroundColor',button_color,...
    'String','1',...
    'Fontsize',[14]);
hL1text=uicontrol;
set(hL1text,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[30 195 90 30],...
    'String','length 1= ',...
    'Fontsize',[16]);

hL2=uicontrol;
set(hL2,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[130 120 110 50],...
    'BackgroundColor',button_color,...
    'String','1',...
    'Fontsize',[14]);
hL2text=uicontrol;
set(hL2text,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[30 125 90 30],...
    'String','length 2= ',...
    'Fontsize',[16]);

hG=uicontrol;
set(hG,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[130 50 110 50],...
    'BackgroundColor',button_color,...
    'String','9.81',...
    'Fontsize',[14]);
hGtext=uicontrol;
set(hGtext,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[30 55 90 30],...
    'String','gravity= ',...
    'Fontsize',[16]);

hPanel2=uipanel(...
    'Parent',hFigure,...
    'Units','Pixels',...
    'Position',[700,150,300,400],...
    'BackgroundColor',panel_color2);

hT1=uicontrol;
set(hT1,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'Position',[160 330 110 50],...
    'BackgroundColor',button_color,...
    'String','pi/2',...
    'Fontsize',[14]);

hT1text=uicontrol;
set(hT1text,...
    'Style','text',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'Position',[60 335 90 30],...
    'String','theta1(0)= ',...
    'Fontsize',[12]);



hT2=uicontrol;
set(hT2,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'Position',[160 260 110 50],...
    'BackgroundColor',button_color,...
    'String','pi',...
    'Fontsize',[14]);
hT2text=uicontrol;
set(hT2text,...
    'Style','text',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'Position',[60 265 90 30],...
    'String','theta2(0)= ',...
    'Fontsize',[12]);

hDt1=uicontrol;
set(hDt1,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'Position',[160 190 110 50],...
    'BackgroundColor',button_color,...
    'String','0',...
    'Fontsize',[14]);
hDt1text=uicontrol;
set(hDt1text,...
    'Style','text',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'Position',[60 195 90 30],...
    'String','Dtheta1(0)= ',...
    'Fontsize',[12]);

hDt2=uicontrol;
set(hDt2,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'Position',[160 120 110 50],...
    'BackgroundColor',button_color,...
    'String','0',...
    'Fontsize',[14]);
hDt2text=uicontrol;
set(hDt2text,...
    'Style','text',...
    'Parent',hPanel2,...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'Position',[60 125 90 30],...
    'String','Dtheta2(0)= ',...
    'Fontsize',12);
hTtext=uicontrol;
set(hTtext,...
    'Style','text',...
    'Parent',hPanel2,...
    'Position',[20 20 100 20],...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'String','time span: ',...
    'Fontsize',[14]);
hT0a=uicontrol;
set(hT0a,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Position',[120 15 50 40],...
    'Units','pixels',...
    'BackgroundColor',button_color,...
    'String','0',...
    'Fontsize',[12]);
hT0b=uicontrol;
set(hT0b,...
    'Style','edit',...
    'Parent',hPanel2,...
    'Position',[220 15 50 40],...
    'Units','pixels',...
    'BackgroundColor',button_color,...
    'String','3',...
    'Fontsize',[12]);
har=uicontrol;
set(har,...
    'Style','text',...
    'Parent',hPanel2,...
    'Position',[170 20 45 20],...
    'Units','pixels',...
    'BackgroundColor',panel_color2,...
    'String','==>',...
    'Fontsize',[14]);
hPanelline=uipanel;
set(hPanelline,...
    'Parent',hFigure,...
    'Units','pixels',...
    'Position',[500 30 410 100],...
    'BackgroundColor',panel_color);

hNumpoints=uicontrol;
set(hNumpoints,...
    'Style','edit',...
    'Parent',hPanel,...
    'Units','pixels',...
    'Position',[70 10 50 30],...
    'BackgroundColor',button_color,...
    'String','500',...
    'Fontsize',[12]);
hnptext=uicontrol;
set(hnptext,...
    'Style','text',...
    'Parent',hPanel,...
    'Units','pixels',...
    'BackgroundColor',panel_color,...
    'Position',[10 10 60 35],...
    'String','# of points ',...
    'Fontsize',[9]);


hPlot1=uicontrol;
set(hPlot1,...
    'Style','checkbox',...
    'Parent',hPanelline,...
    'Units','pixels',...
    'Position',[10 50 390 40],...
    'BackgroundColor',button_color,...
    'Value',0,...
    'Fontsize',12,...
    'String','trace the path of m2 simultaneously with animation');


hPlot2=uicontrol;
set(hPlot2,...
    'Style','checkbox',...
    'Parent',hPanelline,...
    'Units','pixels',...
    'Position',[10 20 390 40],...
    'BackgroundColor',button_color,...
    'Value',0,...
    'Fontsize',12,...
    'String','plot the path of mass 2 after animation is complete');

    

hBegin=uicontrol;
set(hBegin,...
    'Parent',hFigure,...
    'Style','Pushbutton',...
    'Position',[220,30,50,50],...
    'Enable','on',...
    'Units','Pixels',...
    'String','BEGIN',...
    'BackgroundColor',pushbutton_color,...
    'Callback',@begin_Callback);

function begin_Callback(hObject,Eventdata)
clear all; clc;
hold off
t0a=get(hT0a,'string');
t0a=eval(t0a);
t0b=get(hT0b,'string');
t0b=eval(t0b);
t1=get(hT1,'string');
t1=eval(t1);
t2=get(hT2,'string');
t2=eval(t2);
t1prime=get(hDt1,'string');
t1prime=eval(t1prime);
t2prime=get(hDt2,'string');
t2prime=eval(t2prime);
m1=get(hM1,'string');
m1=eval(m1);
m2=get(hM2,'string');
m2=eval(m2);
L1=get(hL1,'string');
L1=eval(L1);
L2=get(hL2,'string');
L2=eval(L2);
g=get(hG,'string');
g=eval(g);
a=L1+L2;
v=get(hNumpoints,'string');
v=eval(v);
options=odeset('abstol',10^(-4),'reltol',10^(-4));
[t,z]=ode45(@Pend,[linspace(t0a,t0b,v)],[t1;t2;t1prime;t2prime],options,m1,m2,L1,L2,g);
x1=L1*sin(z(:,1));
y1=-L1*cos(z(:,1));
x2=L1*sin(z(:,1))+L2*sin(z(:,2));
y2=-L1*cos(z(:,1))-L2*cos(z(:,2));


% s=0;
% %s=round(length(x1)/300);
% if s==0
%     s=1;
% end

hold off
plot(0,0);
for j=2:length(x1)
    hLine=line([0,x1(j),x1(j),x2(j)],[0,y1(j),y1(j),y2(j)],'linestyle','-','marker','o','color','k');
    hLine2=line([x2(j-1),x2(j)],[y2(j-1),y2(j)],'EraseMode','none');
    %plot([x1(j),x2(j)],[y1(j),y2(j)]);
    axis([-a a -a a]);
    grid on
    getframe;
    set(hLine,'visible','off');
   b=get(hPlot1,'Value');
    if b==1
        set(hLine2,'visible','on');
    else
        set(hLine2,'visible','off');

    end
end
c=get(hPlot2,'value');
if c==1
    hold on
    plot(x2,y2)
end


end

function zprime=Pend(t,z,m1,m2,L1,L2,g)
zprime=zeros(4,1);
zprime(1)=z(3);
zprime(2)=z(4);
zprime(3)=(-m2*L1*z(4)^2*sin(z(1)-z(2))*cos(z(1)-z(2))...
    +g*m2*sin(z(2))*cos(z(1)-z(2))-m2*L2*z(4)^2*sin(z(1)-z(2))...
    -(m1+m2)*g*sin(z(1)))/(L1*(m1+m2)-m2*L1*cos(z(1)-z(2))^2);
zprime(4)=(m2*L2*z(4)^2*sin(z(1)-z(2))*cos(z(1)-z(2))...
    +g*sin(z(1))*cos(z(1)-z(2))*(m1+m2)+L1*z(4)^2*sin(z(1)-z(2))*(m1+m2)...
    -g*sin(z(2))*(m1+m2))/(L2*(m1+m2)-m2*L2*cos(z(1)-z(2))^2);
end
end