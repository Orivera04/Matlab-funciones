function [gmmfig] = gmm_output(title_bar, title, total_dim)

% Display results for Generalized Markov Model

% global variables (handles only)
global TransColLabelHandle TransRowLabelHandle TransMatrixHandle TransDistHandle MeanFPTHandle 
std_state = get_std_model_state(4);

% local vars
maxdim = 6 ;  % maximum dimension without having to scroll
dim = min(maxdim, total_dim) ;  % max dimension can display at one time

% Main figure
gmmfig = figure('Name', title_bar, ...
                'Units','normalized', ...
                'Color',[0.8 0.8 0.8], ...
                'MenuBar','none', ...
                'NumberTitle','off', ...
                'Position',[0.4 0.05 0.55 0.90], ...
                'Tag','GMM_Output');

% Menu options for this figure
exit = uimenu(gmmfig, ...
              'Label', 'Close Figure',...
              'Tag','CloseFig', ...
              'Callback','close') ;
save = uimenu(gmmfig, ...
              'Label', 'Save Results', ...
              'Callback', sprintf('printto(''gmm'', ''file'') ;'), ...
              'Tag', 'SaveFig') ;
if std_state == 0
save_model = uimenu(gmmfig, ...
              'Label', 'Save Model', ...
              'Callback', sprintf('save_new_model(4);'), ...
              'Tag', 'PrintFig') ;
        end
        

% Title
uicontrol('Parent',gmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.5, ...
	       'Position',[0.1 0.95 0.8 0.04], ...
	       'Style','text', ...
          'String', title, ...
	       'Tag','Title') ;

% Area Text Labels
uicontrol('Parent',gmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.4, ...
	       'Position',[0.2 0.9 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Transition Matrix', ...
	       'Tag','TransitionMatrix');
uicontrol('Parent',gmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.32, ...
	       'Position',[0.725 0.9 0.25 0.04], ...
	       'Style','text', ...
          'String', 'Sojourn Time Vector', ...
	       'Tag','Sojourn');
uicontrol('Parent',gmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.32, ...
	       'Position',[0.2 0.55 0.3 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Occupancy Distribution', ...
	       'Tag','OccDist');
uicontrol('Parent',gmmfig, ...
	       'Units','normalized', ...
	       'FontUnits','normalized', ...
	       'BackgroundColor',[0.8 0.8 0.8], ...
	       'FontSize',0.32, ...
	       'Position',[0.725 0.55 0.25 0.04], ...
          'HorizontalAlignment', 'left', ...
	       'Style','text', ...
          'String', 'Long-Run Cost Rate', ...
	       'Tag','LongRunCost');

% Sliders
if (total_dim > maxdim)

   if total_dim - maxdim == 1
     eachstep = .99 ;
   else 
     eachstep = 1 / (total_dim - maxdim) ;
   end

   uicontrol('Parent',gmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.7 0.62 0.03 0.24], ...
             'Style','slider', ...
             'Value', 1, ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_vtrans(%d)', maxdim), ...
             'Tag','TransVSlider');
   uicontrol('Parent',gmmfig, ...
             'Units','normalized', ...
             'BackgroundColor',[0.752941 0.752941 0.752941], ...
             'Position',[0.06 0.59 0.6 0.024], ...
             'Style','slider', ...
             'SliderStep', [eachstep 1], ...
             'Callback', sprintf('scroll_htrans(%d)', maxdim), ...
             'Tag','TransHSlider');
end

% Transition Matrix Column Labels
for c = 1:dim
  TransColLabelHandle(c) = uicontrol('Parent',gmmfig, ...
	                                  'Units','normalized', ...
	                                  'FontUnits','normalized', ...
	                                  'BackgroundColor',[0.8 0.8 0.8], ...
	                                  'FontSize',0.367816, ...
	                                  'Position',[(.1*c)-0.04 0.86 0.1 0.025], ...
	                                  'Style','text', ...
	                                  'Tag','TransColLabel', ...
                                     'UserData', [c]);
end

% Transition Matrix Row Labels
for r = 1:dim
  TransRowLabelHandle(r) = uicontrol('Parent',gmmfig, ...
	                                  'Units','normalized', ...
	                                  'FontUnits','normalized', ...
	                                  'BackgroundColor',[0.8 0.8 0.8], ...
	                                  'FontSize',0.355556, ...
	                                  'Position',[0.01 0.86-(0.04*r) 0.05 0.04], ...
	                                  'Style','text', ...
	                                  'Tag','TransRowLabel', ...
                                     'UserData', [r]);
end

% Transition Matrix Value
for r = 1:dim
  for c = 1:dim
    TransMatrixHandle(r,c) = uicontrol('Parent',gmmfig, ...
	                                    'Units','normalized', ...
	                                    'FontUnits','normalized', ...
             	                        'BackgroundColor',[1 1 1], ...
	                                    'FontSize',0.367816, ...
	                                    'Position',[(.1*c)-0.04 0.86-(0.04*r) 0.1 0.04], ...
	                                    'Style','edit', ...
	                                    'Tag','TransMatrixValue', ...
                                       'UserData', [r,c]);
  end
end

% Sojourn Time Vector
for r = 1:dim
  MeanFPTHandle(r) = uicontrol('Parent',gmmfig, ...
	                        'Units','normalized', ...
    	                     'FontUnits','normalized', ...
	                        'BackgroundColor',[1 1 1], ...
	                        'FontSize',0.355556, ...
	                        'Position',[0.75 0.86-(0.04*r) 0.2 0.04], ...
	                        'Style','edit', ...
	                        'Tag','FPTValue', ...
                           'UserData', [r]);
end

% Occupancy Distribution Value
for c = 1:dim
  TransDistHandle(c) = uicontrol('Parent',gmmfig, ...
	                             'Units','normalized', ...
	                             'FontUnits','normalized', ...
	                             'BackgroundColor',[1 1 1], ...
	                             'FontSize',0.367816, ...
	                             'Position',[(.1*c)-0.04 0.50 0.1 0.04], ...
	                             'Style','edit', ...
	                             'Tag','TransDistValue', ...
                                'UserData', [c]);
end

% Long-Run Cost Value
LRCostHandle(r) = uicontrol('Parent',gmmfig, ...
                            'Units','normalized', ...
                            'FontUnits','normalized', ...
                            'BackgroundColor',[1 1 1], ...
                            'FontSize',0.355556, ...
                            'Position',[0.75 0.50 0.20 0.04], ...
                            'Style','edit', ...
                            'Tag','LongRunCostValue', ...
                            'UserData', [r]);

