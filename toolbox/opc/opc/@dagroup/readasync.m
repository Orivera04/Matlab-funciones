function transID = readasync(obj)
%READASYNC Read data asynchronously from group or items.
%   TransID = READASYNC(GObj) and 
%   TransID = READASYNC(IObj) asynchronously reads data for all the items
%   contained in the dagroup object, GObj, or for the vector of daitem
%   objects specified by IObj. TransID is a unique transaction ID for the
%   asynchronous request.
%
%   For asynchronous reads, data is always read from the device, and not
%   from the server cache. The Active property is ignored for asynchronous
%   reads.
%
%   When the read operation completes, a ReadAsync event is generated by
%   the server. If an M-file callback function is specified for the
%   ReadAsyncFcn property, then that function executes when the event is
%   generated.
%
%   You can cancel an in-progress asynchronous request using CANCELASYNC.
%
%   Examples
%       da = opcda('localhost', 'Matrikon.OPC.Simulation');
%       connect(da);
%       grp = addgroup(da, 'ExReadAsync');
%       set(grp, 'UpdateRate', 20);
%       itm = additem(grp, 'Random.Real8');
%       tid1 = readasync(grp)
%       tid2 = readasync(grp, 'device')
%       pause(2)
%       disp('Event log:')
%       showopcevents(da)
%
%   See also DAGROUP/CANCELASYNC, DAGROUP/READ, DAGROUP/REFRESH, 
%            DAGROUP/WRITE, DAGROUP/WRITEASYNC.

% Copyright 2003-2004 OPTI-NUM solutions (Pty) Ltd.
% $Revision: 1.1.6.8 $  $Date: 2004/03/24 20:43:16 $

% Object must be a scalar
if length(obj) > 1
    rethrow(mkerrstruct('opc:readasync:vecnotsupported'));
end   

% Group must be valid
if ~isvalid(obj)
    rethrow(mkerrstruct('opc:readasync:objinvalid'));
end

% Group must be connected
if ~strcmpi(get(get(obj,'Parent'),'Status'),'connected')
    rethrow(mkerrstruct('opc:readasync:parentdisconnected'));
end

% Group must contain items
if isempty(get(obj, 'Item')),
    rethrow(mkerrstruct('opc:readasync:emptygroup'));
end

% Perform the read
try
    transID = udreadasync(getudd(obj));
catch
    rethrow(mkerrstruct(lasterror));
end
