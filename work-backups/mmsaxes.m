function mmsaxes(arg)
%MMSAXES Set Axes Specifications using a GUI. (MM)
% MMSAXES creates a GUI to set or modify the specifications
% of the current axes.
% MMSAXES(Ha) considers the axes having handle Ha.
%
% GUI Pushbuttons:
% Default - Get Default Values (but don't apply them).
% Revert - Revert to Original Axes Specs (but don't apply them).
% Apply - Apply Changes.
% Done - Quit without making further changes.

% Calls: mmgcf mmgca mmsetpos mmsetptr

% D.C. Hanselman, University of Maine, Orono, ME  04469
% 11/30/96, v5: 1/15/97 4/2/98
% Mastering MATLAB 5, Prentice Hall, ISBN 0-13-858366-8
% Mastering MATLAB 6, Prentice Hall, ISBN 0-13-019468-9

if nargin==0  % use current axes
   Hfgui=findall(0,'Type','figure','Tag','MMSAXES');
   if ~isempty(Hfgui) % GUI exists, just go to it
      figure(Hfgui)
      return
   end
   Hf=mmgcf(1);
   arg=mmgca(Hf,1);
elseif arg>0  % use axes provided
   if ~strcmp(get(arg,'Type'),'axes')
      error('Handle Does Not Point to an Axes.')
   end
   Hf=get(arg,'Parent');
end
if arg>0  % initialize GUI
   figure(Hf)
   rgb=get(0,'DefaultUicontrolBackgroundColor');
   Ha=arg;
   w=85; h=20; ht=h-4; sp=5; bt=2*(h+sp); pr=ht+h+sp;
   c=sp+(w+sp)*(0:5);
   b=bt+[3 2 1 0]*pr;
   d=b-h;
   gpos=mmsetpos([0 0 c(6)+w+sp b(1)+h+sp],Hf,'pixels','center','below');
   Hfgui=figure('units','pixels',...
      'Position',gpos,...
      'MenuBar',menubar,...
      'Resize','off',...
      'BackingStore','off',...
      'Colormap',[],...
      'InvertHardcopy','off',...
      'PaperPositionMode','auto',...
      'HandleVisibility','callback',...
      'IntegerHandle','off',...
      'NumberTitle','off',...
      'Name','MM: Set Axes Specs',...
      'Color',rgb,...
      'Visible','off',...
      'Tag','MMSAXES');
   
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(1) b(1) w ht],...
      'String','Aspect')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(2) b(1) w ht],...
      'String','Visible')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(3) b(1) w ht],...
      'String','TickDir')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(4) b(1) w ht],...
      'String','Box')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(5) b(1) w ht],...
      'String','View')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(6) b(1) w ht],...
      'String','[az  el]')
   
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(1) b(2) w ht],...
      'String','XGrid')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(2) b(2) w ht],...
      'String','XDir')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(3) b(2) w ht],...
      'String','XScale')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(4) b(2) w ht],...
      'String','XTick')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(5) b(2) w ht],...
      'String','XLimMode')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(6) b(2) w ht],...
      'String','XLimits')
   
   
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(1) b(3) w ht],...
      'String','YGrid')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(2) b(3) w ht],...
      'String','YDir')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(3) b(3) w ht],...
      'String','YScale')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(4) b(3) w ht],...
      'String','YTick')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(5) b(3) w ht],...
      'String','YLimMode')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(6) b(3) w ht],...
      'String','YLimits')
   
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(1) b(4) w ht],...
      'String','ZGrid')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(2) b(4) w ht],...
      'String','ZDir')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(3) b(4) w ht],...
      'String','ZScale')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(4) b(4) w ht],...
      'String','ZTick')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(5) b(4) w ht],...
      'String','ZLimMode')
   uicontrol('Parent',Hfgui,'Style','text',...
      'Position',[c(6) b(4) w ht],...
      'String','ZLimits')
   
   uicontrol('Parent',Hfgui,'Style','PushButton',...
      'Position',[c(1) sp w h],...
      'String','MMSTICK',...
      'Callback','mmstick mmsaxes');
   uicontrol('Parent',Hfgui,'Style','PushButton',...
      'Position',[c(2) sp w h],...
      'String','Default',...
      'Callback','mmsaxes(-3)');
   uicontrol('Parent',Hfgui,'Style','PushButton',...
      'Position',[c(3) sp w h],...
      'String','Revert',...
      'Callback','mmsaxes(-1)');
   uicontrol('Parent',Hfgui,'Style','Pushbutton',...
      'Position',[c(4) sp w h],...
      'String','Apply',...
      'Callback','mmsaxes(-2)');
   uicontrol('Parent',Hfgui,'Style','PushButton',...
      'Position',[c(5) sp w h],...
      'String','Done',...
      'Callback','close(findobj(''Type'',''figure'',''Tag'',''MMSAXES''))');
   
   onoff='On|Off';
   inout='In|Out';
   dir='Normal|Reverse';
   scal='Linear|Log';
   mode='Auto|Manual->';
   aspect='Normal|Square|Equal|Both';
   d23='  2D|  3D|Other->';
   
   val=ones(4,7);   % values storage
   Hui=zeros(4,6);  % handle storage
   
   pbarm=get(Ha,'PlotBoxAspectRatioMode');
   darm=get(Ha,'DataAspectRatioMode');
   if strcmp(pbarm,'auto') & strcmp(darm,'auto')
      val(1,1)=1;
   elseif strcmp(pbarm,'manual') &...
         strcmp(darm,'auto') & all(get(Ha,'PlotBoxAspectRatio')==[1 1 1])
      val(1,1)=2;
   elseif strcmp(darm,'manual') & all(get(Ha,'DataAspectRatio')==[1 1 1])
      val(1,1)=3;
   else
      val(1,1)=4;
   end
   if strcmp(get(Ha,'Visible'),'off'), val(1,2)=2; end
   if strcmp(get(Ha,'TickDir'),'out'), val(1,3)=2; end
   if strcmp(get(Ha,'Box'),'off'), val(1,4)=2; end
   azel=get(Ha,'view');
   azel=azel-360*(azel>180);
   val(1,6:7)=azel;
   if     all(azel==[0 90]),    val(1,5)=1;
   elseif all(azel==[-37.5 30]),val(1,5)=2;
   else,                        val(1,5)=3;
   end
   
   Hui(1,1)=uicontrol('Parent',Hfgui,'Style','Popup',... % aspect
      'Units','Pixels','Position',[c(1) d(1) w h],...
      'String',aspect,'Value',val(1,1));
   Hui(1,2)=uicontrol('Parent',Hfgui,'Style','Popup',... % visible
      'Units','Pixels','Position',[c(2) d(1) w h],...
      'String',onoff,'Value',val(1,2));
   Hui(1,3)=uicontrol('Parent',Hfgui,'Style','Popup',... % tickdir
      'Units','Pixels','Position',[c(3) d(1) w h],...
      'String',inout,'Value',val(1,3));
   Hui(1,4)=uicontrol('Parent',Hfgui,'Style','Popup',... % box
      'Units','Pixels','Position',[c(4) d(1) w h],...
      'String',onoff,'Value',val(1,4));
   Hui(1,5)=uicontrol('Parent',Hfgui,'Style','Popup',... % 2d3d
      'Units','Pixels','Position',[c(5) d(1) w h],...
      'String',d23,'Value',val(1,5));
   Hui(1,6)=uicontrol('Parent',Hfgui,'Style','Edit',... % view
      'Units','Pixels','Position',[c(6) d(1) w h],...
      'String',sprintf('[%.3g  %.3g]',val(1,6:7)));
   
   if strcmp(get(Ha,'Xgrid'),'off'),       val(2,1)=2; end
   if strcmp(get(Ha,'XDir'),'reverse'),    val(2,2)=2; end
   if strcmp(get(Ha,'Xscale'),'log'),      val(2,3)=2; end
   if length(get(Ha,'Xtick'))==0,          val(2,4)=2; end
   if strcmp(get(Ha,'XLimMode'),'manual'), val(2,5)=2; end
   val(2,6:7)=get(Ha,'Xlim');
   
   Hui(2,1)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(1) d(2) w h],...
      'String',onoff,'Value',val(2,1));
   Hui(2,2)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(2) d(2) w h],...
      'String',dir,'Value',val(2,2));
   Hui(2,3)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(3) d(2) w h],...
      'String',scal,'Value',val(2,3));
   Hui(2,4)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(4) d(2) w h],...
      'String',onoff,'Value',val(2,4));
   Hui(2,5)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(5) d(2) w h],...
      'String',mode,'Value',val(2,5));
   Hui(2,6)=uicontrol('Parent',Hfgui,'Style','Edit',...
      'Units','Pixels','Position',[c(6) d(2) w h],...
      'String',sprintf('[%.3g  %.3g]',val(2,6:7)));
   
   if strcmp(get(Ha,'Ygrid'),'off'),       val(3,1)=2; end
   if strcmp(get(Ha,'YDir'),'reverse'),    val(3,2)=2; end
   if strcmp(get(Ha,'Yscale'),'log'),      val(3,3)=2; end
   if length(get(Ha,'Ytick'))==0,          val(3,4)=2; end
   if strcmp(get(Ha,'YLimMode'),'manual'), val(3,5)=2; end
   val(3,6:7)=get(Ha,'Ylim');
   
   Hui(3,1)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(1) d(3) w h],...
      'String',onoff,'Value',val(3,1));
   Hui(3,2)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(2) d(3) w h],...
      'String',dir,'Value',val(3,2));
   Hui(3,3)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(3) d(3) w h],...
      'String',scal,'Value',val(3,3));
   Hui(3,4)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(4) d(3) w h],...
      'String',onoff,'Value',val(3,4));
   Hui(3,5)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(5) d(3) w h],...
      'String',mode,'Value',val(3,5));
   Hui(3,6)=uicontrol('Parent',Hfgui,'Style','Edit',...
      'Units','Pixels','Position',[c(6) d(3) w h],...
      'String',sprintf('[%.3g  %.3g]',val(3,6:7)));
   
   if strcmp(get(Ha,'Zgrid'),'off'),       val(4,1)=2; end
   if strcmp(get(Ha,'ZDir'),'reverse'),    val(4,2)=2; end
   if strcmp(get(Ha,'Zscale'),'log'),      val(4,3)=2; end
   if length(get(Ha,'Ztick'))==0,          val(4,4)=2; end
   if strcmp(get(Ha,'ZLimMode'),'manual'), val(4,5)=2; end
   val(4,6:7)=get(Ha,'Zlim');
   
   Hui(4,1)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(1) d(4) w h],...
      'String',onoff,'Value',val(4,1));
   Hui(4,2)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(2) d(4) w h],...
      'String',dir,'Value',val(4,2));
   Hui(4,3)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(3) d(4) w h],...
      'String',scal,'Value',val(4,3));
   Hui(4,4)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(4) d(4) w h],...
      'String',onoff,'Value',val(4,4));
   Hui(4,5)=uicontrol('Parent',Hfgui,'Style','Popup',...
      'Units','Pixels','Position',[c(5) d(4) w h],...
      'String',mode,'Value',val(4,5));
   Hui(4,6)=uicontrol('Parent',Hfgui,'Style','Edit',...
      'Units','Pixels','Position',[c(6) d(4) w h],...
      'String',sprintf('[%.3g  %.3g]',val(4,6:7)));
   
   set(Hfgui,'Userdata',{Ha,Hui,val},'Visible','on')
   mmputptr(Hfgui)
   
elseif arg==-1  % Revert Callback
   Hfgui=findobj('Type','figure','Tag','MMSAXES');
   data=get(Hfgui,'Userdata');
   [Ha,Hui,val]=deal(data{:});
   
   for r=1:4
      set(Hui(r,1),'Value',val(r,1))
      set(Hui(r,2),'Value',val(r,2))
      set(Hui(r,3),'Value',val(r,3))
      set(Hui(r,4),'Value',val(r,4))
      set(Hui(r,5),'Value',val(r,5))
      set(Hui(r,6),'String',sprintf('[%.3g  %.3g]',val(r,6:7)))
   end
   
elseif arg==-2  % Apply Callback
   Hfgui=findobj('Type','figure','Tag','MMSAXES');
   data=get(Hfgui,'Userdata');
   [Ha,Hui,val]=deal(data{:});
   
   onoff=['on ';'off'];
   inout=['in ';'out'];
   dir=['normal';'revers'];
   scal=['lin';'log'];
   mode=['auto';'manu'];
   
   switch get(Hui(1,1),'Value');
   case 1
      set(Ha,'PlotBoxAspectRatioMode','auto',...
         'DataAspectRatioMode','auto')
   case 2  % square
      set(Ha,'PlotBoxAspectRatio',[1 1 1],...
         'DataAspectRatioMode','auto')
   case 3  % equal
      apos=mmgetpos(Ha,'Pixels');
      set(Ha,'DataAspectRatio',[1 1 1],...
         'PlotBoxAspectRatio',apos([3 4 4]))
   otherwise
      set(Ha,'PlotBoxAspectRatio',[1 1 1],...
         'DataAspectRatio',[1 1 1])
   end		
   set(Ha,'Visible',onoff(get(Hui(1,2),'Value'),:),...
      'TickDir', inout(get(Hui(1,3),'Value'),:),...
      'Box',     onoff(get(Hui(1,4),'Value'),:),...
      'XGrid',   onoff(get(Hui(2,1),'Value'),:),...
      'XDir',    dir(get(Hui(2,2),'Value'),:),...
      'XScale',  scal(get(Hui(2,3),'Value'),:),...
      'XLimMode',mode(get(Hui(2,5),'Value'),:),...
      'YGrid',   onoff(get(Hui(3,1),'Value'),:),...
      'YDir',    dir(get(Hui(3,2),'Value'),:),...
      'YScale',  scal(get(Hui(3,3),'Value'),:),...
      'YLimMode',mode(get(Hui(3,5),'Value'),:),...
      'ZGrid',   onoff(get(Hui(4,1),'Value'),:),...
      'ZDir',    dir(get(Hui(4,2),'Value'),:),...
      'ZScale',  scal(get(Hui(4,3),'Value'),:),...
      'ZLimMode',mode(get(Hui(4,5),'Value'),:))
   
   vv=get(Hui(1,5),'Value');
   if     vv==1, set(Ha,'View',[0 90])
   elseif vv==2, set(Ha,'View',[-37.5 30])
   else,         set(Ha,'View',eval(get(Hui(1,6),'String'),'val(1,6:7)'))
   end
   if get(Hui(2,4),'Value')==2, set(Ha,'Xtick',[])
   else,                        set(Ha,'XTickMode','auto')
   end
   if get(Hui(3,4),'Value')==2, set(Ha,'Ytick',[])
   else,                        set(Ha,'YTickMode','auto')
   end
   if get(Hui(4,4),'Value')==2, set(Ha,'Ztick',[])
   else                         set(Ha,'ZTickMode','auto')
   end
   if get(Hui(2,5),'Value')==2
      set(Ha,'XLim',eval(get(Hui(2,6),'String'),'val(2,6:7)'))
   else
      set(Hui(2,6),'String',sprintf('[%.3g  %.3g]',get(Ha,'Xlim')))
   end
   if get(Hui(3,5),'Value')==2
      set(Ha,'YLim',eval(get(Hui(3,6),'String'),'val(3,6:7)'))
   else
      set(Hui(3,6),'String',sprintf('[%.3g  %.3g]',get(Ha,'Ylim')))
   end
   if get(Hui(4,5),'Value')==2
      set(Ha,'ZLim',eval(get(Hui(4,6),'String'),'val(4,6:7)'))
   else
      set(Hui(4,6),'String',sprintf('[%.3g  %.3g]',get(Ha,'Zlim')))
   end
   set(Hui(1,3),'Value',1+strcmp(get(Ha,'TickDir'),'out'))
   
   
elseif arg==-3  % Default Callback
   Hfgui=findobj('Type','figure','Tag','MMSAXES');
   data=get(Hfgui,'Userdata');
   [Ha,Hui,val]=deal(data{:});
   Hf=get(Ha,'Parent');
   set(Hui(1,1),'Value',val(1,1))
   set(Hui(1,2),'Value',val(1,2))
   set(Hui(1,3),'Value',val(1,3))
   set(Hui(1,4),'Value',val(1,4))
   set(Hui(1,5),'Value',val(1,5))
   set(Hui(1,6),'String',sprintf('[%.3g  %.3g]',val(1,6:7)))
   
   set(Hui(2,1),'Value',1+strcmp(get(Hf,'DefaultAxesXGrid'),'off'))
   set(Hui(2,2),'Value',1+strcmp(get(Hf,'DefaultAxesXDir'),'reverse'))
   set(Hui(2,3),'Value',1+strcmp(get(Hf,'DefaultAxesXDir'),'log'))
   set(Hui(2,4),'Value',1+strcmp(get(Hf,'DefaultAxesXTickMode'),'manual'))
   set(Hui(2,5),'Value',1+strcmp(get(Hf,'DefaultAxesXLimMode'),'manual'))
   
   set(Hui(3,1),'Value',1+strcmp(get(Hf,'DefaultAxesYGrid'),'off'))
   set(Hui(3,2),'Value',1+strcmp(get(Hf,'DefaultAxesYDir'),'reverse'))
   set(Hui(3,3),'Value',1+strcmp(get(Hf,'DefaultAxesYDir'),'log'))
   set(Hui(3,4),'Value',1+strcmp(get(Hf,'DefaultAxesYTickMode'),'manual'))
   set(Hui(3,5),'Value',1+strcmp(get(Hf,'DefaultAxesYLimMode'),'manual'))
   
   set(Hui(4,1),'Value',1+strcmp(get(Hf,'DefaultAxesZGrid'),'off'))
   set(Hui(4,2),'Value',1+strcmp(get(Hf,'DefaultAxesZDir'),'reverse'))
   set(Hui(4,3),'Value',1+strcmp(get(Hf,'DefaultAxesZDir'),'log'))
   set(Hui(4,4),'Value',1+strcmp(get(Hf,'DefaultAxesZTickMode'),'manual'))
   set(Hui(4,5),'Value',1+strcmp(get(Hf,'DefaultAxesZLimMode'),'manual'))
end
