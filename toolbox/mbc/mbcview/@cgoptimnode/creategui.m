function [LYT, TBLYT, d] = creategui(CGND, info);
%CREATEGUI
%
%  [LYT, TBLYT, ViewData] = creategui(CGND, info);

%  Copyright 2000-2004 The MathWorks, Inc. and Ford Global Technologies, Inc.

%  $Revision: 1.8.6.2 $    $Date: 2004/04/04 03:33:49 $


% ---------------- General Initialisation ------------------------------
cbs=Callbacks(CGND,'GetHandles');
cgb=info.browserH;
Fig = info.Figure;
hndls.Figure = Fig;

% Create an image list for optimization lists
d.ILmanager=xregGui.ILmanager;
d.ILmanager.IL.MaskColor=uint32(255*256*256 + 255);   % Magenta mask
d.ILmanager.ResourceLocation=cgrespath;
bmp2ind(d.ILmanager,'cgblanknode.bmp');
IL=d.ILmanager.IL;


% ---------------- Menu setup ------------------------------------------
menus=cgb.createmenu(guid(CGND),1);
set(menus,'label','&Optimization');
m = menus(1);
hndls.RunMenu = uimenu(m , ...
    'label' , '&Run', ...
    'enable', 'off', ...
    'callback', cbs.Run);
hndls.SetUpandRunMenu = uimenu(m , ...
    'label' , 'Set &Up and Run...', ...
    'enable', 'off', ...
    'callback', cbs.SetUpandRun);
hndls.SetUpMenu = uimenu(m , ...
    'label' , '&Set Up', ...
    'enable', 'off', ...
    'callback', cbs.SetUp);
hndls.ObjMenu = uimenu(m , ...
    'label' , '&Objective', ...
    'Separator', 'on');
hndls.AddObjMenu = uimenu(hndls.ObjMenu, ...
    'label', '&Add Objective', ...
    'enable', 'off',...
    'callback', cbs.AddObj);
hndls.SelObjMenu = uimenu(hndls.ObjMenu, ...
    'label', '&Edit Objective...', ...
    'callback', cbs.SelObj);
hndls.DelObjMenu = uimenu(hndls.ObjMenu, ...
    'label', '&Delete Objective..', ...
    'enable', 'off',...
    'callback', cbs.DelObj);
hndls.ConMenu = uimenu(m , 'label' , '&Constraint');
hndls.AddConMenu = uimenu(hndls.ConMenu, ...
    'label', '&Add Constraint', ...
    'enable', 'off', ...
    'callback', cbs.AddCo);
hndls.EditConMenu = uimenu(hndls.ConMenu, ...
    'label', '&Edit Constraint...', ...
    'callback', cbs.EditCo);
hndls.DelConMenu = uimenu(hndls.ConMenu, ...
    'label', '&Delete Constraint', ...
    'enable', 'off',...
    'callback', cbs.DelCo);
hndls.DSMenu = uimenu(m , 'label' , 'Operating &Point Set');
hndls.AddDSMenu = uimenu(hndls.DSMenu, ...
    'label', '&Add Operating Point Set', ...
    'enable', 'off', ...
    'callback', cbs.AddDS);
hndls.SelDSMenu = uimenu(hndls.DSMenu, ...
    'label', '&Edit Operating Point Set...', ...
    'callback', cbs.SelDS);
hndls.DelDSMenu = uimenu(hndls.DSMenu, 'label', ...
    '&Delete Operating Point Set', ...
    'enable', 'off', ...
    'callback', cbs.DelDS);


% ---------------- Toolbar setup ------------------------------------------
icons = cell(6,1);
icons{1} = cgresload('optimnewobjective.bmp','bmp');
icons{2} = cgresload('optimnewcon.bmp','bmp');
icons{3} = cgresload('optimnewdataset.bmp','bmp');
icons{4} = cgresload('optimsetup.bmp','bmp');
icons{5} = cgresload('optimsetupgo.bmp','bmp');
icons{6} = cgresload('optimgo.bmp','bmp');

toolcbs = {cbs.AddObj;cbs.AddCo;cbs.AddDS;cbs.SetUp;cbs.SetUpandRun; cbs.Run};

tooltips = {'Add Objective';...
        'Add Constraint';...
        'Add Operating Point Set';...
        'Set Up Optimization';...
        'Set Up and Run Optimization';...
        'Run Optimization'};

transpclr = [0 255 0];

sep = {'off';'off';'off';'on';'off';'off'};

[TBLYT,btns] = xregtoolbar(info.Figure,{'uipush','uipush','uipush','uipush','uipush','uipush'}, ... 
    {'Cdata'},icons,...
    {'ClickedCallback'},toolcbs,...
    {'ToolTipString'},tooltips,...
    'TransparentColor',transpclr, ...
    {'Separator'}, sep);

hndls.Toolbar.AddObj = btns(1);
hndls.Toolbar.AddCo = btns(2);
hndls.Toolbar.AddDS = btns(3);
hndls.Toolbar.SetUp = btns(4);
hndls.Toolbar.SetUpandRun = btns(5);
hndls.Toolbar.Run = btns(6);


% ---------------- Main UI setup ------------------------------------------

%%%%%%%%%%%%%%% General Information pane %%%%%%%%%%%%%%%%%%
hndls.InfoPane = xregGui.infoPane('parent', Fig, ...
    'visible', 'off', ...
    'splitposition', 0.35);

%%%%%%%%%%%%%%% Objectives Layout %%%%%%%%%%%%%%%%%%
listcbacks = {'ColumnClick', 'xreglvsorter'; 'MouseMove', 'MotionManager'};
hndls.ObjList = pr_CreateList(Fig, listcbacks, 'Objective',IL);
cheaders = {'Name','Description',  'Type', 'Information'};
cwidth = [120, 170, 100, 140];
pr_ConfigureList(hndls.ObjList, cheaders, cwidth);

%%%%%%%%%%%%%%% Datasets Layout %%%%%%%%%%%%%%%%%%
hndls.DSList = pr_CreateList(Fig, listcbacks, 'Operating Point Set',IL);
cheaders = {'Name', 'Description', 'Type','Information'};
cwidth = [120, 170, 100, 140];
pr_ConfigureList(hndls.DSList, cheaders, cwidth);

%%%%%%%%%%%%%%% Cosntraints Layout %%%%%%%%%%%%%%%%%%
hndls.ConList = pr_CreateList(Fig, listcbacks, 'Constraint',IL);
cheaders = {'Name',  'Description', 'Information'};
cwidth = [120, 170, 140];
pr_ConfigureList(hndls.ConList, cheaders, cwidth);

%%%%%%%%%%%%%%% ActiveX Callbacks %%%%%%%%%%%%%%%%%%
hndls.Listeners.ActiveX.Click = [ ...
        handle.listener(hndls.ObjList, 'ItemClick', cbs.ListClick); ...
        handle.listener(hndls.DSList, 'ItemClick', cbs.ListClick); ...
        handle.listener(hndls.ConList, 'ItemClick', cbs.ListClick) ...
    ];
hndls.Listeners.ActiveX.DblClick = [ ...
        handle.listener(hndls.ObjList, 'DblClick', cbs.ListDblClick); ...
        handle.listener(hndls.DSList, 'DblClick', cbs.ListDblClick); ...
        handle.listener(hndls.ConList, 'DblClick', cbs.ListDblClick) ...
    ];
hndls.Listeners.ActiveX.RightClick = [ ...
        handle.listener(hndls.ObjList, 'RightClick', cbs.ListRightClick); ...
        handle.listener(hndls.DSList, 'RightClick', cbs.ListRightClick); ...
        handle.listener(hndls.ConList, 'RightClick', cbs.ListRightClick) ...
    ];

%%%%%%%%%%%%%%% Overall Layout %%%%%%%%%%%%%%%%%%
panel1 = xregpaneltitlelayout(Fig , ...
    'packstatus', 'off', ...
    'visible','on',...
    'title' , 'Optimization Information', ...
    'center' , hndls.InfoPane);
panel2 = xregpaneltitlelayout(Fig , ...
    'visible','on',...
    'title' , 'Objectives', ...
    'center' , hndls.ObjList); 
panel3 = xregpaneltitlelayout(Fig , ...
    'visible','on',...
    'title' , 'Constraints',...
    'center' , hndls.ConList);
panel4 = xregpaneltitlelayout(Fig , ...
    'visible','on',...
    'title' , 'Operating Point Sets', ...
    'center' , hndls.DSList);
LYT=xreggridbaglayout(Fig,...
    'packstatus','off',...
    'dimension',[4 1],...
    'gapy', 2, ...
    'rowsizes',[100 -1 -1 -1],...
    'rowratios', [0 1 1 1],...
    'elements',{panel1, panel2, panel3, panel4});


%%%%%%%%%%%%%%% Statusbar Message %%%%%%%%%%%%%%%%%%
hndls.MessageID = [];
d.Handles = hndls;


%%%%%%%%%%%%%%% Context Menu %%%%%%%%%%%%%%%%%%
d = pr_CreateContextMenu(Fig, d);