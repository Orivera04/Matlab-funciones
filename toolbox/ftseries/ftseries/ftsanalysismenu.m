function varargout = ftsanalysismenu(varargin)
%FTSANALYSISMENU The Analysis menu item of FTS GUI.
%
%   FTSANALYSISMENU generates the Analysis menu item of the financial time
%   series GUI, ftsgui.  Please start the GUI from the MATLAB command line using
%
%      ftsgui
%
%   See also FTSGUI.

%   NOTE: Need to be called from ftsgui.m.

%   Author: P. N. Secakusuma, 01-10-2000
%   Copyright 1995-2003 The MathWorks, Inc.
%   $Revision: 1.11.2.3 $   $Date: 2004/04/06 01:09:22 $

switch nargin,
    case 0,
        mainFTSGUIWindow = findall(0, 'Type', 'figure', ...
            'Tag' , 'FTSGUIMainWindow');
        MenuItems = {'&Analysis'     , ''                      , 'analysisMenuItem'                      ;
            '>&Exp( ... )'           , 'ftsanalysismenu(1)'    , 'analysisExpMenuItem'                   ;
            '>&Log( ... )'           , 'ftsanalysismenu(2)'    , 'analysisLogMenuItem'                   ;
            '>Log&10( ... )'         , 'ftsanalysismenu(3)'    , 'analysisLog10MenuItem'                 ;
            '>Log&2( ... )'          , 'ftsanalysismenu(4)'    , 'analysisLog2MenuItem'                  ;
            '>-----'                 , ''                      , ''                                      ;
            '>Basic &Statistics'     , 'ftsanalysismenu(5)'    , 'analysisBasicStatsMenuItem'            ;
            '>-----'                 , ''                      , ''                                      ;
            '>&Difference'           , 'ftsanalysismenu(6)'    , 'analysisDiffMenuItem'                  ;
            '>&Periodic Average'     , 'ftsanalysismenu(7)'    , 'analysisPerAvgMenuItem'                ;
            '>-----'                 , ''                      , ''                                      ;
            '>&Technical Analysis'   , ''                      , 'analysisTechAnalMenuItem'              ;
            '>>A/D Oscillator'       , 'ftsanalysismenu(8,  1)', 'analysisTechAnalADOscMenuItem'         ;
            '>>Chaikin Oscillator'   , 'ftsanalysismenu(8,  2)', 'analysisTechAnalChaikOscMenuItem'      ;
            '>>MACD'                 , 'ftsanalysismenu(8,  3)', 'analysisTechAnalMACDMenuItem'          ;
            '>>Stochastic Oscillator', 'ftsanalysismenu(8,  4)', 'analysisTechAnalStochOscMenuItem'      ;
            '>>Acceleration'         , 'ftsanalysismenu(8,  5)', 'analysisTechAnalAccelMenuItem'         ;
            '>>Momentum'             , 'ftsanalysismenu(8,  6)', 'analysisTechAnalMomentumMenuItem'      ;
            '>>-----'                , ''                      , ''                                      ;
            '>>Chaikin''s Volatility', 'ftsanalysismenu(8,  7)', 'analysisTechAnalChaikVolMenuItem'      ;
            '>>Fast %K && Fast %D'   , 'ftsanalysismenu(8,  8)', 'analysisTechAnalFastStochMenuItem'     ;
            '>>Slow %K && Slow %D'   , 'ftsanalysismenu(8,  9)', 'analysisTechAnalSlowStochMenuItem'     ;
            '>>William''s %R'        , 'ftsanalysismenu(8, 10)', 'analysisTechAnalWilliamsPctRMenuItem'  ;
            '>>-----'                , ''                      , ''                                      ;
            '>>NVI'                  , 'ftsanalysismenu(8, 11)', 'analysisTechAnalNVIMenuItem'           ;
            '>>PVI'                  , 'ftsanalysismenu(8, 12)', 'analysisTechAnalPVIMenuItem'           ;
            '>>RSI'                  , 'ftsanalysismenu(8, 13)', 'analysisTechAnalRSIMenuItem'           ;
            '>>-----'                , ''                      , ''                                      ;
            '>>A/D Line'             , 'ftsanalysismenu(8, 14)', 'analysisTechAnalADLineMenuItem'        ;
            '>>Bollinger Band'       , 'ftsanalysismenu(8, 15)', 'analysisTechAnalBollingerBandMenuItem' ;
            '>>Highest High'         , 'ftsanalysismenu(8, 16)', 'analysisTechAnalHighestHighMenuItem'   ;
            '>>Lowest Low'           , 'ftsanalysismenu(8, 17)', 'analysisTechAnalLowestLowMenuItem'     ;
            '>>Median Price'         , 'ftsanalysismenu(8, 18)', 'analysisTechAnalMedianPriceMenuItem'   ;
            '>>OBV'                  , 'ftsanalysismenu(8, 19)', 'analysisTechAnalOBVMenuItem'           ;
            '>>Price Rate-of-Change' , 'ftsanalysismenu(8, 20)', 'analysisTechAnalPriceROCMenuItem'      ;
            '>>PVT'                  , 'ftsanalysismenu(8, 21)', 'analysisTechAnalPVTMenuItem'           ;
            '>>Typical Price'        , 'ftsanalysismenu(8, 22)', 'analysisTechAnalTypicalPriceMenuItem'  ;
            '>>Volume Rate-of-Change', 'ftsanalysismenu(8, 23)', 'analysisTechAnalVolumeROCMenuItem'     ;
            '>>Weighted Close'       , 'ftsanalysismenu(8, 24)', 'analysisTechAnalWeightedCloseMenuItem' ;
            '>>William''s A/D Line'  , 'ftsanalysismenu(8, 25)', 'analysisTechAnalWilliamsADLineMenuItem'};
        hAnalysisMenuItems = makemenu(mainFTSGUIWindow, str2mat(MenuItems{:, 1}), str2mat(MenuItems{:, 2}), str2mat(MenuItems{:, 3}));

        varargout{1} = hAnalysisMenuItems;

    case {1, 2, 3},
        mainFTSGUIWindow = findall(0, 'Type', 'figure', ...
            'Tag', 'FTSGUIMainWindow');
        infostorage = getappdata(mainFTSGUIWindow, 'FTS_Data');

        % If there is no active figure selected
        if isempty(infostorage.activefts)
            errordlg('No data loaded or no active FTS is selected.', 'No Active FTS', 'modal');
            return
        end

        [MAT_data, data_names, data_info] = getftsguidata(infostorage.activefts);

        switch varargin{1},
            case 0,   % Unimplemented feature message
                warndlg('Feature not yet implemented.', 'No Feature');

            case 1,   % EXP
                try
                    [ftsData, ftsName] = execftsdatafcn('exp');

                catch
                    errMsg = lasterror;
                    errorExp = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Exp) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end
                hpfig = displayftsfcnresult(ftsData, ftsName, 'exp');
                updateftsguistatus(1, ['exp: ', deblank(MAT_data.desc)]);
                ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                drawnow;

            case 2,   % LOG
                try
                    [ftsData, ftsName] = execftsdatafcn('log');

                catch
                    errMsg = lasterror;
                    errorLog = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Log) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end
                hpfig = displayftsfcnresult(ftsData, ftsName, 'log');
                updateftsguistatus(1, ['log: ', deblank(MAT_data.desc)]);
                ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                drawnow;

            case 3,   % LOG10
                try
                    [ftsData, ftsName] = execftsdatafcn('log10');

                catch
                    errMsg = lasterror;
                    errorLog10 = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Log10) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end
                hpfig = displayftsfcnresult(ftsData, ftsName, 'log10');
                updateftsguistatus(1, ['log10: ', deblank(MAT_data.desc)]);
                ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                drawnow;

            case 4,   % LOG2
                try
                    [ftsData, ftsName] = execftsdatafcn('log2');

                catch
                    errMsg = lasterror;
                    errorLog2 = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Log2) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end
                hpfig = displayftsfcnresult(ftsData, ftsName, 'log2');
                updateftsguistatus(1, ['log2: ', deblank(MAT_data.desc)]);
                ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                drawnow;

            case 5,   % Basic statistics: MEAN, MAX, MIN, STD
                holdName = [];
                try
                    [ftsDataMean, ftsName] = execftsdatafcn('mean', 'stats');

                catch
                    errMsg = lasterror;
                    errorBSMean = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Basic statistics/Mean) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end

                try
                    [ftsDataMax,  ftsName] = execftsdatafcn('max', 'stats');

                catch
                    errMsg = lasterror;
                    errorBSMax = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Basic statistics/Max) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end


                try
                    [ftsDataMin,  ftsName] = execftsdatafcn('min', 'stats');

                catch
                    errMsg = lasterror;
                    errorBSMin = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Basic statistics/Min) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end


                try
                    [ftsDataStd,  ftsName] = execftsdatafcn('std', 'stats');

                catch
                    errMsg = lasterror;
                    errorBSSTD = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Basic statistics/STD) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end


                ftsDataFNames  = [{''}; fieldnames(ftsDataMean) ; {''}];
                ftsDataMeanVal = [{[]}; struct2cell(ftsDataMean); {[]}];
                ftsDataMaxVal  = [{[]}; struct2cell(ftsDataMax) ; {[]}];
                ftsDataMinVal  = [{[]}; struct2cell(ftsDataMin) ; {[]}];
                ftsDataStdVal  = [{[]}; struct2cell(ftsDataStd) ; {[]}];

                hpfig = figure('MenuBar', 'none', ...
                    'NumberTitle', 'off', ...
                    'Name', 'Basic Statistics:', ...
                    'Units', 'normal', ...
                    'Position', [0.35 0.35 0.3 0.3], ...
                    'CloseRequestFcn', ['try,', ...
                    '   fig = findall(0, ''Type'', ''figure'', ', ...
                    '                 ''Tag'', ''FTSGUIMainWindow''); ', ...
                    '   hChildrenFigs = getappdata(fig, ''ChildrenFigures'');', ...
                    '   hCurrentFigs = find(hChildrenFigs ~= gcf);', ...
                    '   setappdata(fig, ''ChildrenFigures'', hChildrenFigs(hCurrentFigs));', ...
                    '   closereq;', ...
                    'catch,', ...
                    '   closereq;', ...
                    'end;'], ...
                    'Resize', 'off', ...
                    'WindowStyle', 'normal', ...
                    'Tag', 'basicstatsfig');

                hnametitle = uicontrol('Style', 'text', ...
                    'String', {''; 'Series Name:'}, ...
                    'Units', 'normal', ...
                    'Position', [0.05 0.8 0.245 0.085], ...
                    'Tag', 'basicstatsnametitle');
                hmeantitle = uicontrol('Style', 'text', ...
                    'String', {''; 'Mean:'}, ...
                    'Units', 'normal', ...
                    'Position', [0.3 0.8 0.145 0.085], ...
                    'Tag', 'basicstatsmeantitle');
                hmaxtitle = uicontrol('Style', 'text', ...
                    'String', {''; 'Maximum:'}, ...
                    'Units', 'normal', ...
                    'Position', [0.45 0.8 0.145 0.085], ...
                    'Tag', 'basicstatsmaxtitle');
                hmintitle = uicontrol('Style', 'text', ...
                    'String', {''; 'Minimum:'}, ...
                    'Units', 'normal', ...
                    'Position', [0.6 0.8 0.145 0.085], ...
                    'Tag', 'basicstatsmintitle');
                hstdtitle = uicontrol('Style', 'text', ...
                    'String', {'Standard'; 'Deviation:'}, ...
                    'Units', 'normal', ...
                    'Position', [0.75 0.8 0.2 0.085], ...
                    'Tag', 'basicstatsstdtitle');

                hnamelist = uicontrol('Style', 'text', ...
                    'String', ftsDataFNames, ...
                    'Units', 'normal', ...
                    'Position', [0.05 0.725-((length(ftsDataFNames)-1)*0.0425) 0.245 (length(ftsDataFNames))*0.0425], ...
                    'Tag', 'basicstatsnamelist');
                hmeanlist = uicontrol('Style', 'text', ...
                    'String', ftsDataMeanVal, ...
                    'Units', 'normal', ...
                    'Position', [0.3 0.725-((length(ftsDataFNames)-1)*0.0425) 0.145 (length(ftsDataFNames))*0.0425], ...
                    'Tag', 'basicstatsmeanlist');
                hmaxlist  = uicontrol('Style', 'text', ...
                    'String', ftsDataMaxVal, ...
                    'Units', 'normal', ...
                    'Position', [0.45 0.725-((length(ftsDataFNames)-1)*0.0425) 0.145 (length(ftsDataFNames))*0.0425], ...
                    'Tag', 'basicstatsmaxlist');
                hminlist  = uicontrol('Style', 'text', ...
                    'String', ftsDataMinVal, ...
                    'Units', 'normal', ...
                    'Position', [0.6 0.725-((length(ftsDataFNames)-1)*0.0425) 0.145 (length(ftsDataFNames))*0.0425], ...
                    'Tag', 'basicstatsminlist');
                hstdlist  = uicontrol('Style', 'text', ...
                    'String', ftsDataStdVal, ...
                    'Units', 'normal', ...
                    'Position', [0.75 0.725-((length(ftsDataFNames)-1)*0.0425) 0.2 (length(ftsDataFNames))*0.0425], ...
                    'Tag', 'basicstatsstdlist');

                hokbutton = uicontrol('Style', 'pushbutton', ...
                    'String', 'OK', ...
                    'Units', 'normal', ...
                    'Position', [0.3 0.075 0.15 0.075], ...
                    'Callback', 'closereq;', ...
                    'Tag', 'basicstatsokbutton');
                hhelpbutton = uicontrol('Style', 'pushbutton', ...
                    'String', 'Help', ...
                    'Units', 'normal', ...
                    'Position', [0.55 0.075 0.15 0.075], ...
                    'Callback', 'doc mean', ...
                    'Tag', 'basicstatshelpbutton');

                mainFTSGUIWindow = findall(0, 'Type', 'figure', ...
                    'Tag', 'FTSGUIMainWindow');
                hChildrenFigs = getappdata(mainFTSGUIWindow, 'ChildrenFigures');
                setappdata(mainFTSGUIWindow, 'ChildrenFigures', [hChildrenFigs, hpfig]);

                updateftsguistatus(1, ['basic statistics: ', deblank(MAT_data.desc)]);
                drawnow;

            case 6,   % DIFF
                try
                    [ftsData, ftsName] = execftsdatafcn('diff');

                catch
                    errMsg = lasterror;
                    errorDiff = errordlg(cleanerrormsg(errMsg.message), ...
                        'FTSGUI (Difference) error', 'modal');

                    ftsData = []; ftsName = [];
                    return
                end
                hpfig = displayftsfcnresult(ftsData, ftsName, 'diff');
                updateftsguistatus(1, ['diff: ', deblank(MAT_data.desc)]);
                ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                drawnow;

            case 7,   % PERAVG
                if nargin == 1,
                    hperavgfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                        'NumberTitle', 'off', ...
                        'MenuBar', 'none', ...
                        'Name', 'Periodic Average (peravg)', ...
                        'Resize', 'off', ...
                        'WindowStyle', 'modal', ...
                        'Units', 'normal', ...
                        'Position', [0.4 0.4 0.2 0.15], ...
                        'HandleVisibility', 'callback', ...
                        'Tag', 'peravgdlg');

                    hnumrb = uicontrol('Style', 'radiobutton', ...
                        'String', 'Period length, repeating:', ...
                        'Units', 'normal', ...
                        'Position', [0.05 0.775 0.9 0.125], ...
                        'Value', 1, ...
                        'Callback', 'ftsanalysismenu(7, 1);', ...
                        'Tag', 'peravgnumrb');
                    hnumtb = uicontrol('Style', 'text', ...
                        'String', 'Length of a period: ', ...
                        'HorizontalAlignment', 'right', ...
                        'Units', 'normal', ...
                        'Position', [0.1 0.645 0.5 0.125], ...
                        'Enable', 'on', ...
                        'Tag', 'peravgnumtb');
                    hnumetb = uicontrol('Style', 'edit', ...
                        'BackgroundColor', 'w', ...
                        'String', '5', ...
                        'Units', 'normal', ...
                        'Position', [0.6 0.660 0.15 0.125], ...
                        'Enable', 'on', ...
                        'Tag', 'peravgnumetb');

                    hstrrb = uicontrol('Style', 'radiobutton', ...
                        'String', 'Date bounds, non-repeating:', ...
                        'Units', 'normal', ...
                        'Position', [0.05 0.465 0.9 0.125], ...
                        'Value', 0, ...
                        'Callback', 'ftsanalysismenu(7, 2);', ...
                        'Tag', 'peravgstrrb');
                    hstrtb1 = uicontrol('Style', 'text', ...
                        'String', 'From:', ...
                        'HorizontalAlignment', 'right', ...
                        'Units', 'normal', ...
                        'Position', [0.15 0.335 0.125 0.125], ...
                        'Enable', 'off', ...
                        'Tag', 'peravgstrtb1');
                    hstretb1 = uicontrol('Style', 'edit', ...
                        'BackgroundColor', 'w', ...
                        'String', 'mm/dd/yy', ...
                        'Units', 'normal', ...
                        'Position', [0.3 0.35 0.235 0.125], ...
                        'Enable', 'off', ...
                        'Tag', 'peravgstretb1');
                    hstrtb2 = uicontrol('Style', 'text', ...
                        'String', 'to:', ...
                        'HorizontalAlignment', 'right', ...
                        'Units', 'normal', ...
                        'Position', [0.525 0.335 0.075 0.125], ...
                        'Enable', 'off', ...
                        'Tag', 'peravgstrtb1');
                    hstretb2 = uicontrol('Style', 'edit', ...
                        'BackgroundColor', 'w', ...
                        'String', 'mm/dd/yy', ...
                        'Units', 'normal', ...
                        'Position', [0.625 0.35 0.235 0.125], ...
                        'Enable', 'off', ...
                        'Tag', 'peravgstretb2');

                    hokbutton = uicontrol('Style', 'pushbutton', ...
                        'String', 'OK', ...
                        'Units', 'normal', ...
                        'Position', [0.10 0.075 0.2 0.175], ...
                        'Callback', 'ftsanalysismenu(7, 3);', ...
                        'Tag', 'peravgokbutton');
                    hcancelbutton = uicontrol('Style', 'pushbutton', ...
                        'String', 'Cancel', ...
                        'Units', 'normal', ...
                        'Position', [0.40 0.075 0.2 0.175], ...
                        'Callback', 'closereq;', ...
                        'Tag', 'peravgcancelbutton');
                    hhelpbutton = uicontrol('Style', 'pushbutton', ...
                        'String', 'Help', ...
                        'Units', 'normal', ...
                        'Position', [0.70 0.075 0.2 0.175], ...
                        'Callback', 'doc peravg', ...
                        'Tag', 'peravghelpbutton');
                elseif nargin == 2,
                    switch varargin{2},
                        case 1,   % Period length radiobutton callback
                            hnumrb   = findall(0, 'Tag', 'peravgnumrb');
                            hnumtb   = findall(0, 'Tag', 'peravgnumtb');
                            hnumetb  = findall(0, 'Tag', 'peravgnumetb');
                            hstrrb   = findall(0, 'Tag', 'peravgstrrb');
                            hstrtb1  = findall(0, 'Tag', 'peravgstrtb1');
                            hstretb1 = findall(0, 'Tag', 'peravgstretb1');
                            hstrtb2  = findall(0, 'Tag', 'peravgstrtb2');
                            hstretb2 = findall(0, 'Tag', 'peravgstretb2');
                            if get(hnumrb, 'Value') == 1,
                                set(hstrrb, 'Value', 0);
                                set(hnumtb,   'Enable', 'on');
                                set(hnumetb,  'Enable', 'on');
                                set(hstrtb1,  'Enable', 'off');
                                set(hstretb1, 'Enable', 'off');
                                set(hstrtb2,  'Enable', 'off');
                                set(hstretb2, 'Enable', 'off');
                            elseif get(hnumrb, 'Value') == 0,
                                set(hnumrb, 'Value', 1);
                            end;
                        case 2,   % Date Bounds radiobutton callback
                            hnumrb   = findall(0, 'Tag', 'peravgnumrb');
                            hnumtb   = findall(0, 'Tag', 'peravgnumtb');
                            hnumetb  = findall(0, 'Tag', 'peravgnumetb');
                            hstrrb   = findall(0, 'Tag', 'peravgstrrb');
                            hstrtb1  = findall(0, 'Tag', 'peravgstrtb1');
                            hstretb1 = findall(0, 'Tag', 'peravgstretb1');
                            hstrtb2  = findall(0, 'Tag', 'peravgstrtb2');
                            hstretb2 = findall(0, 'Tag', 'peravgstretb2');
                            if get(hstrrb, 'Value') == 1,
                                set(hnumrb, 'Value', 0);
                                set(hnumtb,   'Enable', 'off');
                                set(hnumetb,  'Enable', 'off');
                                set(hstrtb1,  'Enable', 'on');
                                set(hstretb1, 'Enable', 'on');
                                set(hstrtb2,  'Enable', 'on');
                                set(hstretb2, 'Enable', 'on');
                            elseif get(hstrrb, 'Value') == 0,
                                set(hstrrb, 'Value', 1);
                            end;
                        case 3,   % OK pushbutton callback
                            hnumrb_val = get(findall(0, 'Tag', 'peravgnumrb'), 'Value');
                            hstrrb_val = get(findall(0, 'Tag', 'peravgstrrb'), 'Value');
                            if hnumrb_val,
                                hnumetb_perlen = str2double(get(findall(0, 'Tag', 'peravgnumetb'), 'String'));
                                opt_param = hnumetb_perlen;
                            elseif hstrrb_val,
                                hstretb1_date = get(findall(0, 'Tag', 'peravgstretb1'), 'String');
                                hstretb2_date = get(findall(0, 'Tag', 'peravgstretb2'), 'String');
                                opt_param = [hstretb1_date, '::', hstretb2_date];
                            end
                            closereq;

                            if isempty(opt_param) | strcmp(opt_param, '::'),
                                opt_param = 5;
                            end

                            % Check to make sure the number of dates/times is < opt_param
                            if (mod(opt_param,1) ~= 0) | (opt_param <= 0)
                                errorPeravg = errordlg('The Period Length must be an integer greater than one.', ...
                                    'FTSGUI (Periodic Average) error', 'modal');

                                ftsData = []; ftsName = [];
                                return
                            end
                            if size(MAT_data,1) <= opt_param
                                greaterFlag = 1;
                            else
                                greaterFlag = 0;
                            end

                            % Get version and if there is time data
                            [ftsVersion,timeData] = fintsver(MAT_data);
                            if ftsVersion
                                MAT_data = ftsold2new(MAT_data); % This sorts the fts too.
                            elseif ~issorted(ftsa);
                                MAT_data = sortfts(MAT_data);
                            end

                            try
                                [ftsData, ftsName] = execftsdatafcn('peravg', opt_param);

                            catch
                                errMsg = lasterror;
                                errorPeravg2 = errordlg(cleanerrormsg(errMsg.message), ...
                                    'FTSGUI (Periodic Average) error', 'modal');

                                ftsData = []; ftsName = [];
                                return
                            end
                            ftsDatanames = fieldnames(ftsData)';
                            ftsData = struct2cell(ftsData);
                            ftsData = cat(1, ftsData{:})';

                            datesbound = ftsbound(MAT_data);
                            newdates = [datesbound(1):(datesbound(2)-datesbound(1))/(size(ftsData, 1)-1):datesbound(2)]';
                            if greaterFlag
                                if timeData
                                    newdates = MAT_data.dates(end) + MAT_data.times(end);
                                else
                                    newdates = MAT_data.dates(end);
                                end
                            end
                            ftsData = fints(newdates, ftsData, ftsDatanames, 0, ['PERAVG: ', deblank(MAT_data.desc)]);
                            hpfig = displayftsfcnresult(ftsData, ftsName, 'peravg');
                            updateftsguistatus(1, ['peravg: ', deblank(MAT_data.desc)]);
                            drawnow;
                    end
                else
                    errordlg('Invalid number of inputs', 'FTSGUI (Difference) error', 'modal');
                end

            case 8,   % Technical Analysis Functions
                switch varargin{2},
                    case 1,   % ADOSC
                        try
                            [ftsData, ftsName] = execftsdatafcn('adosc');

                        catch
                            errMsg = lasterror;
                            errorAdosc = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (A/D Oscillator) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'adosc');
                        updateftsguistatus(1, ['adosc: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case  2,   % CHAIKOSC
                        try
                            [ftsData, ftsName] = execftsdatafcn('chaikosc');

                        catch
                            errMsg = lasterror;
                            errorChaikosc = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (Chaikin Oscillator) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'chaikosc');
                        updateftsguistatus(1, ['chaikosc: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case  3,   % MACD
                        try
                            [ftsData, ftsName] = execftsdatafcn('macd');

                        catch
                            errMsg = lasterror;
                            errorMacd = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (MACD) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'macd');
                        updateftsguistatus(1, ['macd: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case  4,   % STOCHOSC
                        if nargin == 2,
                            hstochoscfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Stochastic Oscillator (stochosc)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'stochoscdlg');

                            hkpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of %K period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.71 0.5 0.125], ...
                                'Tag', 'stochosckpertb');
                            hkperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '10', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.725 0.15 0.125], ...
                                'Tag', 'stochosckperetb');
                            hdpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of %D period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.535 0.5 0.125], ...
                                'Tag', 'stochoscdpertb');
                            hdperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '3', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.550 0.15 0.125], ...
                                'Tag', 'stochoscdperetb');
                            hmamettb  = uicontrol('Style', 'text', ...
                                'String', 'Moving average method: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.370 0.5 0.125], ...
                                'Tag', 'stochoscmamettb');
                            hmametetb = uicontrol('Style', 'popupmenu', ...
                                'BackgroundColor', 'w', ...
                                'String', {'Exponential (e)'; 'Triangular (t)'}, ...
                                'Value', 1, ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.385 0.4 0.125], ...
                                'Tag', 'stochoscmametetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 4, 1)', ...
                                'Tag', 'stochoscokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'stochosccancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc stochosc', ...
                                'Tag', 'stochoschelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hkperetb_val  = str2double(get(findall(0, 'Tag', 'stochosckperetb'), 'String'));
                                    hdperetb_val  = str2double(get(findall(0, 'Tag', 'stochoscdperetb'), 'String'));
                                    hmametetb_val = get(findall(0, 'Tag', 'stochoscmametetb'), 'Value');
                                    if isempty(hkperetb_val),
                                        hkperetb_val = 10;
                                    end
                                    if isempty(hdperetb_val),
                                        hdperetb_val = 3;
                                    end
                                    if isempty(hmametetb_val) | hmametetb_val == 1,
                                        hmametetb_val = 'e';
                                    elseif hmametetb_val == 2,
                                        hmametetb_val = 't';
                                    end
                                    opt_param = {hkperetb_val, hdperetb_val, hmametetb_val};
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('stochosc', opt_param{:});

                                    catch
                                        errMsg = lasterror;
                                        errorStochosc = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Stochastic Oscillator) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'stochosc');
                                    updateftsguistatus(1, ['stochosc: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case  5,   % TSACCEL
                        if nargin == 2,
                            htsaccelfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Time Series Acceleration (tsaccel)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'tsacceldlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of a period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.71 0.40 0.125], ...
                                'Tag', 'tsaccelnpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '12', ...
                                'Units', 'normal', ...
                                'Position', [0.45 0.725 0.15 0.125], ...
                                'Tag', 'tsaccelnperetb');
                            hdtyptb  = uicontrol('Style', 'text', ...
                                'String', 'Input data type: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.535 0.40 0.125], ...
                                'Tag', 'tsacceldtyptb');
                            hdtypetb = uicontrol('Style', 'popupmenu', ...
                                'BackgroundColor', 'w', ...
                                'String', {'Time Series Data (0)'; 'Momentum Data (1)'}, ...
                                'Value', 1, ...
                                'Units', 'normal', ...
                                'Position', [0.45 0.550 0.50 0.125], ...
                                'Tag', 'tsacceldtypetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 5, 1)', ...
                                'Tag', 'tsaccelokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'tsaccelcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc tsaccel', ...
                                'Tag', 'tsaccelhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'tsaccelnperetb'), 'String'));
                                    hdtypetb_val  = get(findall(0, 'Tag', 'tsacceldtypetb'), 'Value');
                                    if isempty(hnperetb_val),
                                        hkperetb_val = 12;
                                    end
                                    if isempty(hdtypetb_val) | hdtypetb_val == 1,
                                        hdperetb_val = 0;
                                    elseif hdtypetb_val == 2,
                                        hdtypetb_val = 1;
                                    end
                                    opt_param = {hnperetb_val, hdtypetb_val};
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('tsaccel', opt_param{:});

                                    catch
                                        errMsg = lasterror;
                                        errorTsaccel = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Acceleration) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'tsaccel');
                                    updateftsguistatus(1, ['tsaccel: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case  6,   % TSMOM
                        try
                            [ftsData, ftsName] = execftsdatafcn('tsmom');

                        catch
                            errMsg = lasterror;
                            errorTsmom = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (Momentun) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'tsmom');
                        updateftsguistatus(1, ['tsmom: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case  7,   % CHAIKVOLAT
                        if nargin == 2,
                            hchaikvolatfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Chaikin''s Volatility (chaikvolat)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'chaikvolatdlg');

                            hnperdtb  = uicontrol('Style', 'text', ...
                                'String', 'Difference period length: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.71 0.5 0.125], ...
                                'Tag', 'chaikvolatnperdtb');
                            hnperdetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '10', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.725 0.15 0.125], ...
                                'Tag', 'chaikvolatnperdetb');
                            hmapertb  = uicontrol('Style', 'text', ...
                                'String', {'Moving Average period  ', 'length: '}, ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.175], ...
                                'Tag', 'chaikvolatmapertb');
                            hmaperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '10', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.51 0.15 0.125], ...
                                'Tag', 'chaikvolatmaperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 7, 1)', ...
                                'Tag', 'chaikvolatokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'chaikvolatcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc chaikvolat', ...
                                'Tag', 'chaikvolathelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperdetb_val  = str2double(get(findall(0, 'Tag', 'chaikvolatnperdetb'), 'String'));
                                    hmaperetb_val  = str2double(get(findall(0, 'Tag', 'chaikvolatmaperetb'), 'String'));
                                    if isempty(hnperdetb_val),
                                        hkperetb_val = 10;
                                    end
                                    if isempty(hmaperetb_val),
                                        hdperetb_val = 10;
                                    end
                                    opt_param = {hnperdetb_val, hmaperetb_val};
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('chaikvolat', opt_param{:});

                                    catch
                                        errMsg = lasterror;
                                        errorChaikvolat = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Chaikin''s Volatility) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'chaikvolat');
                                    updateftsguistatus(1, ['chaikvolat: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case  8,   % FPCTKD
                        if nargin == 2,
                            hfpctkdfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Fast Stochastics (fpctkd)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'fpctkddlg');

                            hkpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of %K period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.71 0.5 0.125], ...
                                'Tag', 'fpctkdkpertb');
                            hkperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '10', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.725 0.15 0.125], ...
                                'Tag', 'fpctkdkperetb');
                            hdpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of %D period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.535 0.5 0.125], ...
                                'Tag', 'fpctkddpertb');
                            hdperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '3', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.550 0.15 0.125], ...
                                'Tag', 'fpctkddperetb');
                            hmamettb  = uicontrol('Style', 'text', ...
                                'String', 'Moving average method: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.370 0.5 0.125], ...
                                'Tag', 'fpctkdmamettb');
                            hmametetb = uicontrol('Style', 'popupmenu', ...
                                'BackgroundColor', 'w', ...
                                'String', {'Exponential (e)'; 'Triangular (t)'}, ...
                                'Value', 1, ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.385 0.4 0.125], ...
                                'Tag', 'fpctkdmametetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 8, 1)', ...
                                'Tag', 'fpctkdokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'fpctkdcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc fpctkd', ...
                                'Tag', 'fpctkdhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hkperetb_val  = str2double(get(findall(0, 'Tag', 'fpctkdkperetb'), 'String'));
                                    hdperetb_val  = str2double(get(findall(0, 'Tag', 'fpctkddperetb'), 'String'));
                                    hmametetb_val = get(findall(0, 'Tag', 'fpctkdmametetb'), 'Value');
                                    if isempty(hkperetb_val),
                                        hkperetb_val = 10;
                                    end
                                    if isempty(hdperetb_val),
                                        hdperetb_val = 3;
                                    end
                                    if isempty(hmametetb_val) | hmametetb_val == 1,
                                        hmametetb_val = 'e';
                                    elseif hmametetb_val == 2,
                                        hmametetb_val = 't';
                                    end
                                    opt_param = {hkperetb_val, hdperetb_val, hmametetb_val};
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('fpctkd', opt_param{:});

                                    catch
                                        errMsg = lasterror;
                                        errorFpctkd = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Fast %K & Fast %D) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'fpctkd');
                                    updateftsguistatus(1, ['fpctkd: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case  9,   % SPCTKD
                        if nargin == 2,
                            hfpctkdfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Slow Stochastics (spctkd)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'spctkddlg');

                            hfkpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of F%K period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.800 0.5 0.125], ...
                                'Tag', 'spctkdfkpertb');
                            hfkperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '10', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.815 0.15 0.125], ...
                                'Tag', 'spctkdfkperetb');
                            hfdpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of F%D period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.640 0.5 0.125], ...
                                'Tag', 'spctkdfdpertb');
                            hfdperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '3', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.655 0.15 0.125], ...
                                'Tag', 'spctkdfdperetb');
                            hsdpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of S%D period: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.480 0.5 0.125], ...
                                'Tag', 'spctkdsdpertb');
                            hsdperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '3', ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.495 0.15 0.125], ...
                                'Tag', 'spctkdsdperetb');
                            hmamettb  = uicontrol('Style', 'text', ...
                                'String', 'Moving average method: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.05 0.320 0.5 0.125], ...
                                'Tag', 'spctkdmamettb');
                            hmametetb = uicontrol('Style', 'popupmenu', ...
                                'BackgroundColor', 'w', ...
                                'String', {'Exponential (e)'; 'Triangular (t)'}, ...
                                'Value', 1, ...
                                'Units', 'normal', ...
                                'Position', [0.55 0.335 0.4 0.125], ...
                                'Tag', 'spctkdmametetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 9, 1)', ...
                                'Tag', 'spctkdokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'spctkdcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc spctkd', ...
                                'Tag', 'spctkdhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hfkperetb_val  = str2double(get(findall(0, 'Tag', 'spctkdfkperetb'), 'String'));
                                    hfdperetb_val  = str2double(get(findall(0, 'Tag', 'spctkdfdperetb'), 'String'));
                                    hsdperetb_val  = str2double(get(findall(0, 'Tag', 'spctkdsdperetb'), 'String'));
                                    hmametetb_val = get(findall(0, 'Tag', 'spctkdmametetb'), 'Value');
                                    if isempty(hfkperetb_val),
                                        hskperetb_val = 3;
                                    end
                                    if isempty(hfdperetb_val),
                                        hfdperetb_val = 3;
                                    end
                                    if isempty(hsdperetb_val),
                                        hsdperetb_val = 3;
                                    end
                                    if isempty(hmametetb_val) | hmametetb_val == 1,
                                        hmametetb_val = 'e';
                                    elseif hmametetb_val == 2,
                                        hmametetb_val = 't';
                                    end
                                    opt_param1 = {hfkperetb_val, hfdperetb_val, hmametetb_val};
                                    opt_param2 = {hsdperetb_val, hmametetb_val};
                                    closereq;

                                    % Calculate the fast %k
                                    try
                                        [ftsDataFcptkd, ftsNameFcptkd] = execftsdatafcn('fpctkd', opt_param1{:});

                                    catch
                                        errMsg = lasterror;
                                        errorSpctkd = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Slow %K & Slow %D) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    ftsName = strrep(ftsNameFcptkd, 'fpctkd', 'spctkd');

                                    % Use the fast %k data to calculate the slow %k
                                    try
                                        ftsData = spctkd(ftsDataFcptkd, opt_param2{:});

                                    catch
                                        errMsg = lasterror;
                                        errorSpctkd2 = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Slow %K & Slow %D) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end

                                    % Remove the fast %k info from ftsgui
                                    rmftsguidata(ftsNameFcptkd)

                                    % Set the slow %k info in fsgui
                                    setftsguidata({ftsData}, {ftsName}, {fints})
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'spctkd');
                                    updateftsguistatus(1, ['spctkd: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 10,   % WILLPCTR
                        if nargin == 2,
                            hwillpctrfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'William''s %R (willpctr)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'willpctrdlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Number of periods: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'willpctrnpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '14', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'willpctrnperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 10, 1)', ...
                                'Tag', 'willpctrokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'willpctrcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc willpctr', ...
                                'Tag', 'willpctrhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'willpctrnperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 14;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('willpctr', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorWillpctr = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (William''s %R) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'willpctr');
                                    updateftsguistatus(1, ['willpctr: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 11,   % NEGVOLIDX
                        if nargin == 2,
                            hnvifig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Negative Volume Index (negvolidx)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'nvidlg');

                            hinvitb  = uicontrol('Style', 'text', ...
                                'String', {'Initial Negative Volume  '; 'Index (NVI): '}, ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.175], ...
                                'Tag', 'nviinvitb');
                            hinvietb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '100', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.515 0.15 0.125], ...
                                'Tag', 'nviinvietb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 11, 1)', ...
                                'Tag', 'nviokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'nvicancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc negvolidx', ...
                                'Tag', 'nvihelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hinvietb_val  = str2double(get(findall(0, 'Tag', 'nviinvietb'), 'String'));
                                    if isempty(hinvietb_val),
                                        hinvietb_val = 100;
                                    end
                                    opt_param = hinvietb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('negvolidx', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorNegvolidx = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (NVI) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'negvolidx');
                                    updateftsguistatus(1, ['negvolidx: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 12,   % POSVOLIDX
                        if nargin == 2,
                            hpvifig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Positive Volume Index (posvolidx)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'pvidlg');

                            hipvitb  = uicontrol('Style', 'text', ...
                                'String', {'Initial Positive Volume  '; 'Index (PVI): '}, ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.175], ...
                                'Tag', 'pviipvitb');
                            hipvietb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '100', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.515 0.15 0.125], ...
                                'Tag', 'pviipvietb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 12, 1)', ...
                                'Tag', 'pviokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'pvicancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc posvolidx', ...
                                'Tag', 'pvihelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hipvietb_val  = str2double(get(findall(0, 'Tag', 'pviipvietb'), 'String'));
                                    if isempty(hipvietb_val),
                                        hipvietb_val = 100;
                                    end
                                    opt_param = hipvietb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('posvolidx', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorPosvolidx = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (PVI) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'posvolidx');
                                    updateftsguistatus(1, ['posvolidx: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 13,   % RSINDEX
                        if nargin == 2,
                            hrsifig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Relative Strength Index (rsindex)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'rsidlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of a period:', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'rsinpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '14', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'rsinperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 13, 1)', ...
                                'Tag', 'rsiokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'rsicancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc rsindex', ...
                                'Tag', 'rsihelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'rsinperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 14;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('rsindex', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorRsindex = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (RSI) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'rsindex');
                                    updateftsguistatus(1, ['rsindex: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 14,   % ADLINE
                        try
                            [ftsData, ftsName] = execftsdatafcn('adline');

                        catch
                            errMsg = lasterror;
                            errorAdline = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (A/D Line) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'adline');
                        updateftsguistatus(1, ['adline: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 15,   % BOLLINGER
                        if nargin == 2,
                            hbollingerfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Bollinger Band (bollinger)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'bollingerdlg');

                            hwsizetb  = uicontrol('Style', 'text', ...
                                'String', 'Window size: ', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.8 0.5 0.125], ...
                                'Tag', 'bollingerwsizetb');
                            hwsizeetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '20', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.815 0.15 0.125], ...
                                'Tag', 'bollingerwsizeetb');
                            hwtstb  = uicontrol('Style', 'text', ...
                                'String', {'Moving average  ', 'order/weight: '}, ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.60 0.5 0.175], ...
                                'Tag', 'bollingerwtstb');
                            hwtsetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '0', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.585 0.15 0.125], ...
                                'Tag', 'bollingerwtsetb');
                            hnstdtb  = uicontrol('Style', 'text', ...
                                'String', {'Number of standard  ', 'deviations: '}, ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.36 0.5 0.175], ...
                                'Tag', 'bollingernstdtb');
                            hnstdetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '2', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.34 0.15 0.125], ...
                                'Tag', 'bollingernstdetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 15, 1)', ...
                                'Tag', 'bollingerokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'bollingercancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc bollinger', ...
                                'Tag', 'bollingerhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hwsizeetb_val = str2double(get(findall(0, 'Tag', 'bollingerwsizeetb'), 'String'));
                                    hwtsetb_val   = str2double(get(findall(0, 'Tag', 'bollingerwtsetb'),   'String'));
                                    hnstdetb_val  = str2double(get(findall(0, 'Tag', 'bollingernstdetb'),  'String'));
                                    if isempty(hwsizeetb_val),
                                        hwsizeetb_val = 20;
                                    end
                                    if isempty(hwtsetb_val),
                                        hwtsetb_val = 0;
                                    end
                                    if isempty(hnstdetb_val),
                                        hnstdetb_val = 'e';
                                    end
                                    opt_param = {hwsizeetb_val, hwtsetb_val, hnstdetb_val};
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('bollinger', opt_param{:});

                                    catch
                                        errMsg = lasterror;
                                        errorBolllinger = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Bollinger Band) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'bollinger');
                                    updateftsguistatus(1, ['bollinger: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 16,   % HHIGH
                        if nargin == 2,
                            hhhighfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Highest High (hhigh)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'hhighdlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of a period:', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'hhighnpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '14', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'hhighnperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 16, 1)', ...
                                'Tag', 'hhighokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'hhighcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc hhigh', ...
                                'Tag', 'hhighhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'hhighnperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 14;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('hhigh', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorHhigh = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Highest High) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'hhigh');
                                    updateftsguistatus(1, ['hhigh: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 17,   % LLOW
                        if nargin == 2,
                            hllowfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Lowest Low (llow)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'llowdlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of a period:', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'llownpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '14', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'llownperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 17, 1)', ...
                                'Tag', 'llowokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'llowcancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc llow', ...
                                'Tag', 'llowhelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'llownperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 14;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('llow', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorLlow = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Lowest Low) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'llow');
                                    updateftsguistatus(1, ['llow: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 18,   % MEDPRICE
                        try
                            [ftsData, ftsName] = execftsdatafcn('medprice');

                        catch
                            errMsg = lasterror;
                            errorMedprice = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (Median Price) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'medprice');
                        updateftsguistatus(1, ['medprice: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 19,   % ONBALVOL
                        try
                            [ftsData, ftsName] = execftsdatafcn('onbalvol');

                        catch
                            errMsg = lasterror;
                            errorOnbalvol = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (OBV) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'onbalvol');
                        updateftsguistatus(1, ['onbalvol: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 20,   % PRCROC
                        if nargin == 2,
                            hprcrocfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Price Rate-Of-Change (volroc)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'prcrocdlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of ROC period:', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'prcrocnpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '12', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'prcrocnperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 20, 1)', ...
                                'Tag', 'prcrocokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'prcroccancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc prcroc', ...
                                'Tag', 'prcrochelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'prcrocnperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 12;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('prcroc', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorPrcroc = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Price Rat-of-Change) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'prcroc');
                                    updateftsguistatus(1, ['prcroc: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 21,   % PVTREND
                        try
                            [ftsData, ftsName] = execftsdatafcn('pvtrend');

                        catch
                            errMsg = lasterror;
                            errorPvtrend = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (PVT) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'pvtrend');
                        updateftsguistatus(1, ['pvtrend: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 22,   % TYPPRICE
                        try
                            [ftsData, ftsName] = execftsdatafcn('typprice');

                        catch
                            errMsg = lasterror;
                            errorTypprice = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (Typical Price) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'typprice');
                        updateftsguistatus(1, ['typprice: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 23,   % VOLROC
                        if nargin == 2,
                            hvolrocfig = figure('Color', get(0, 'DefaultUIControlBackgroundColor'), ...
                                'NumberTitle', 'off', ...
                                'MenuBar', 'none', ...
                                'Name', 'Volume Rate-Of-Change (volroc)', ...
                                'Resize', 'off', ...
                                'WindowStyle', 'modal', ...
                                'Units', 'normal', ...
                                'Position', [0.4 0.4 0.2 0.15], ...
                                'HandleVisibility', 'callback', ...
                                'Tag', 'volrocdlg');

                            hnpertb  = uicontrol('Style', 'text', ...
                                'String', 'Length of ROC period:', ...
                                'HorizontalAlignment', 'right', ...
                                'Units', 'normal', ...
                                'Position', [0.1 0.535 0.5 0.125], ...
                                'Tag', 'volrocnpertb');
                            hnperetb = uicontrol('Style', 'edit', ...
                                'BackgroundColor', 'w', ...
                                'String', '12', ...
                                'Units', 'normal', ...
                                'Position', [0.6 0.550 0.15 0.125], ...
                                'Tag', 'volrocnperetb');

                            hokbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'OK', ...
                                'Units', 'normal', ...
                                'Position', [0.10 0.075 0.2 0.175], ...
                                'Callback', 'ftsanalysismenu(8, 23, 1)', ...
                                'Tag', 'volrocokbutton');
                            hcancelbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Cancel', ...
                                'Units', 'normal', ...
                                'Position', [0.40 0.075 0.2 0.175], ...
                                'Callback', 'closereq;', ...
                                'Tag', 'volroccancelbutton');
                            hhelpbutton = uicontrol('Style', 'pushbutton', ...
                                'String', 'Help', ...
                                'Units', 'normal', ...
                                'Position', [0.70 0.075 0.2 0.175], ...
                                'Callback', 'doc volroc', ...
                                'Tag', 'volrochelpbutton');
                        elseif nargin == 3,
                            switch varargin{3},
                                case 1,
                                    hnperetb_val  = str2double(get(findall(0, 'Tag', 'volrocnperetb'), 'String'));
                                    if isempty(hnperetb_val),
                                        hnperetb_val = 12;
                                    end
                                    opt_param = hnperetb_val;
                                    closereq;

                                    try
                                        [ftsData, ftsName] = execftsdatafcn('volroc', opt_param);

                                    catch
                                        errMsg = lasterror;
                                        errorVolroc = errordlg(cleanerrormsg(errMsg.message), ...
                                            'FTSGUI (Volume Rate-of-Change) error', 'modal');

                                        ftsData = []; ftsName = [];
                                        return
                                    end
                                    hpfig = displayftsfcnresult(ftsData, ftsName, 'volroc');
                                    updateftsguistatus(1, ['volroc: ', deblank(MAT_data.desc)]);
                                    drawnow;
                            end
                        end

                    case 24,   % WCLOSE
                        try
                            [ftsData, ftsName] = execftsdatafcn('wclose');

                        catch
                            errMsg = lasterror;
                            errorWclose = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (Weighted Close) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'wclose');
                        updateftsguistatus(1, ['wclose: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    case 25,   % WILLAD
                        try
                            [ftsData, ftsName] = execftsdatafcn('willad');

                        catch
                            errMsg = lasterror;
                            errorWillad = errordlg(cleanerrormsg(errMsg.message), ...
                                'FTSGUI (William''s A/D Line) error', 'modal');

                            ftsData = []; ftsName = [];
                            return
                        end
                        hpfig = displayftsfcnresult(ftsData, ftsName, 'willad');
                        updateftsguistatus(1, ['willad: ', deblank(MAT_data.desc)]);
                        ftsfilemenu(1, 3, {ftsName, ftsData.desc})
                        drawnow;

                    otherwise,
                        errordlg('Attempt to switch to never never land', 'Oh no...', 'modal')

                end   % End of SWITCH VARARGIN{2} block.

            otherwise,
                errordlg('Valid flags are 1 thru 8.  Thank you...', 'modal');

        end   % End of SWITCH VARARGIN{1} block.

    otherwise,
        errordlg('Invalid number of input arguments.', 'FILEANALYSISMENU:', 'modal');

end   % End of SWITCH NARGIN block.

% [EOF]
