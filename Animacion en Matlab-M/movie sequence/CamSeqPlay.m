function [M] = CamSeqPlay(seq,fps,filename);
% CamSeqPlay: Play a sequence and generate a movie
%
%   [M] = CamSeqPlay(seq,fps,filename);
%   M: movie (matlab format)
%   seq: sequence generated by CamSeqGen
%   fps: frame per seconde for the avi file
%   filename: if none, just play in the figure window
%
%   The options in movie2avi can be changed for more compression or
%   different codec
%
% Olivier Salvado, Case Western Reserve University, 16-Sep-04 


%%
% check param
if ~exist('dt','var'),
    dt = 0;
else
    dt = 1/fps;
end

if ~exist('filename','var'),
    filename = [];
    M = [];
end


%%
% loop on the frames
N = length(seq.time);
for k =1:N,
    
    campos(seq.pos(k,:))
    camtarget(seq.tar(k,:));
    
    if isempty(filename),
        pause(dt)
    else
        drawnow
        M(k) = getframe(gcf);
    end
        
end

if ~isempty(filename),
    disp('Generating the avi file, this may take a while')
    movie2avi(M,filename,'compression','cinepak','fps',fps);
    disp('done.')
end
    
